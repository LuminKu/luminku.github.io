# 1 ğŸŒº

ä½ åœ¨CentOS 7ä¸­ä½¿ç”¨Dockerè‡ªå®šä¹‰ç½‘ç»œæ—¶ï¼Œé‡åˆ°å®¿ä¸»æœºæ— æ³•è®¿é—®mysql2æœåŠ¡çš„é—®é¢˜ã€‚è¿™é€šå¸¸å’ŒDockerçš„ç½‘ç»œæ¨¡å¼ã€ç«¯å£æ˜ å°„ä»¥åŠå®¹å™¨çš„ç½‘ç»œè¿æ¥æœ‰å…³ã€‚æˆ‘æ¥å¸®ä½ åˆ†æä¸€ä¸‹åŸå› å’Œè§£å†³åŠæ³•ã€‚

# ğŸ” é—®é¢˜åŸå› åˆ†æ

æ ¹æ®ä½ æä¾›çš„æ“ä½œå’Œï¼ŒDockerå®¹å™¨åœ¨ä¸åŒçš„ç½‘ç»œæ¨¡å¼ä¸‹ä¼šæœ‰ä¸åŒçš„ç½‘ç»œè¡Œä¸ºã€‚ä½ çš„`mysql2`å®¹å™¨åªè¿æ¥åˆ°äº†`siti`è¿™ä¸ªè‡ªå®šä¹‰çš„bridgeç½‘ç»œï¼ˆè·å¾—äº†`172.18.0.3`çš„IPï¼‰ï¼Œ**å¹¶æ²¡æœ‰è¿æ¥åˆ°Dockerçš„é»˜è®¤bridgeç½‘ç»œ**ï¼ˆ`172.17.0.0/16`ç½‘æ®µï¼‰ã€‚å®¿ä¸»æœºå°è¯•é€šè¿‡`172.17.0.3`ï¼ˆè¿™å±äºé»˜è®¤bridgeç½‘ç»œçš„ç½‘æ®µï¼‰è®¿é—®`mysql2`å®¹å™¨ï¼Œä½†è¯¥å®¹å™¨åœ¨é»˜è®¤bridgeç½‘ç»œä¸­å¹¶ä¸å­˜åœ¨IPåœ°å€ï¼Œå› æ­¤æ— æ³•è¿æ¥ã€‚

ä¸‹é¢è¡¨æ ¼æ¢³ç†äº†ä½ çš„å®¹å™¨ç½‘ç»œè¿æ¥æƒ…å†µï¼š

| å®¹å™¨å   | è¿æ¥çš„ç½‘ç»œ                  | åœ¨é»˜è®¤bridgeç½‘ç»œä¸­çš„IP (docker0) | åœ¨sitiè‡ªå®šä¹‰ç½‘ç»œä¸­çš„IP | å®¿ä¸»æœºæ˜ å°„ç«¯å£ |
| :------- | :-------------------------- | :-------------------------------- | :--------------------- | :------------- |
| mysql    | **bridge** (é»˜è®¤), **siti** | 172.17.0.2                        | 172.18.0.2             | 3306 â†’ 3306    |
| mysql2   | **siti**                    | **æ— **                            | 172.18.0.3             | 3307 â†’ 3306    |

# ğŸ› ï¸ è§£å†³æ–¹æ³•

### 1. é€šè¿‡å®¿ä¸»æœºæ˜ å°„ç«¯å£è®¿é—®ï¼ˆæ¨èï¼‰
ä½ å·²ä½¿ç”¨ `-p 3307:3306` å°† `mysql2` å®¹å™¨çš„ 3306 ç«¯å£æ˜ å°„åˆ°äº†å®¿ä¸»æœºçš„ 3307 ç«¯å£ã€‚è¿™æ˜¯è®¿é—®å®¹å™¨å†…æœåŠ¡æœ€ç›´æ¥çš„æ–¹å¼ã€‚**ä½ åªéœ€è¦åœ¨å®¿ä¸»æœºä¸Šè¿æ¥ `localhost` æˆ– `127.0.0.1` çš„ 3307 ç«¯å£å³å¯**ï¼š

```bash
mysql80 -uroot -h127.0.0.1 -P3307 -p
# æˆ–è€…
mysql80 -uroot -hlocalhost -P3307 -p
```

### 2. å°†mysql2ä¹Ÿè¿æ¥åˆ°é»˜è®¤bridgeç½‘ç»œ
å¦‚æœä½ å¸Œæœ›ç”¨IPåœ°å€è®¿é—®ï¼Œå¯ä»¥è®© `mysql2` å®¹å™¨ä¹Ÿè¿æ¥åˆ°é»˜è®¤çš„bridgeç½‘ç»œã€‚

```bash
# å°† mysql2 å®¹å™¨è¿æ¥åˆ°é»˜è®¤çš„ bridge ç½‘ç»œ
docker network connect bridge mysql2
```
è¿æ¥åï¼ŒDockerä¼šä¸º`mysql2`å®¹å™¨åœ¨é»˜è®¤çš„bridgeç½‘ç»œï¼ˆ`172.17.0.0/16`ç½‘æ®µï¼‰ä¸­ä¹Ÿåˆ†é…ä¸€ä¸ªIPåœ°å€ï¼ˆä¾‹å¦‚`172.17.0.3`ï¼‰ã€‚ä¹‹åï¼Œä½ å°±å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šé€šè¿‡è¿™ä¸ªæ–°IPå’Œæ˜ å°„çš„ç«¯å£ï¼ˆ3307ï¼‰è®¿é—®äº†ï¼š

```bash
mysql80 -uroot -h172.17.0.3 -P3307 -p
```

**æ³¨æ„**ï¼šå®¹å™¨åœ¨åŒä¸€ä¸ªç½‘ç»œæ¨¡å¼ä¸‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªIPåœ°å€ï¼ˆä¾‹å¦‚ä½ çš„`mysql`å®¹å™¨å°±æœ‰`172.17.0.2`å’Œ`172.18.0.2`ï¼‰ï¼Œè¿™ä¸ä¼šå†²çªã€‚

### 3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
CentOS 7çš„é˜²ç«å¢™ï¼ˆfirewalldï¼‰å¯èƒ½ä¼šé˜»æ­¢å¯¹Dockeræ˜ å°„ç«¯å£çš„è®¿é—®ã€‚ç¡®ä¿å®¿ä¸»æœºçš„é˜²ç«å¢™å¼€æ”¾äº†3307ç«¯å£ï¼š

```bash
# å¼€æ”¾3307ç«¯å£
sudo firewall-cmd --zone=public --add-port=3307/tcp --permanent
# é‡æ–°åŠ è½½é˜²ç«å¢™é…ç½®
sudo firewall-cmd --reload
```

### 4. éªŒè¯å®¹å™¨å’Œç«¯å£æ˜ å°„
ç¡®ä¿`mysql2`å®¹å™¨å†…çš„MySQLæœåŠ¡ç¡®å®åœ¨3306ç«¯å£ä¸Šæ­£å¸¸ç›‘å¬ï¼š

```bash
# è¿›å…¥mysql2å®¹å™¨
docker exec -it mysql2 bash
# åœ¨å®¹å™¨å†…å®‰è£…net-toolsï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
apt update && apt install -y net-tools
# æŸ¥çœ‹ç›‘å¬ç«¯å£
netstat -tlnp | grep mysql
```
ç¡®è®¤è¾“å‡ºä¸­åŒ…å« `0.0.0.0:3306` æˆ– `:::3306`ã€‚

åŒæ—¶ï¼Œæ£€æŸ¥å®¹å™¨çš„ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®ï¼š

```bash
docker port mysql2
```
ç¡®è®¤è¾“å‡ºä¸­åŒ…å« `3306/tcp -> 0.0.0.0:3307`ã€‚

# ğŸ’¡ å¦‚ä½•é¿å…ç±»ä¼¼é—®é¢˜

1.  **ç†è§£Dockerç½‘ç»œæ¨¡å¼**ï¼šåœ¨Dockerä¸­ï¼Œå®¹å™¨é€šè¿‡**ç½‘ç»œé©±åŠ¨**ï¼ˆå¦‚bridgeã€overlayã€macvlanã€hostã€noneï¼‰è¿æ¥ç½‘ç»œã€‚è‡ªå®šä¹‰bridgeç½‘ç»œé€šå¸¸èƒ½æä¾›æ›´å¥½çš„å®¹å™¨å‘ç°å’Œéš”ç¦»ã€‚
2.  **ä½¿ç”¨å®¹å™¨åè®¿é—®**ï¼šåœ¨**è‡ªå®šä¹‰ç½‘ç»œ**ï¼ˆå¦‚ä½ çš„`siti`ç½‘ç»œï¼‰ä¸­ï¼ŒDockeræä¾›äº†å†…ç½®çš„**DNSæœåŠ¡**ï¼Œå®¹å™¨ä¹‹é—´å¯ä»¥ç›´æ¥é€šè¿‡å®¹å™¨åè®¿é—®ã€‚ä¾‹å¦‚ï¼Œåœ¨`siti`ç½‘ç»œä¸­çš„å…¶ä»–å®¹å™¨å¯ä»¥ç›´æ¥ç”¨ `mysql2` è¿™ä¸ªä¸»æœºåè¿æ¥åˆ°`mysql2`å®¹å™¨ï¼ˆä½†ä½ é‡åˆ°çš„é—®é¢˜æ˜¯ä»å®¿ä¸»æœºè®¿é—®ï¼Œæ­¤ç‰¹æ€§ä¸é€‚ç”¨ï¼‰ã€‚
3.  **æ˜ç¡®è®¿é—®è·¯å¾„**ï¼š
    *   ä»**å®¿ä¸»æœº**è®¿é—®å®¹å™¨æœåŠ¡ï¼šä¼˜å…ˆä½¿ç”¨ `-p` å‚æ•°å‘å¸ƒçš„**ç«¯å£æ˜ å°„**ï¼Œå¹¶é€šè¿‡ `127.0.0.1:å®¿ä¸»æ˜ å°„ç«¯å£` è¿æ¥ã€‚
    *   ä»**å®¹å™¨å†…**è®¿é—®å…¶ä»–å®¹å™¨æœåŠ¡ï¼šå¦‚æœå®ƒä»¬åœ¨**åŒä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œ**ä¸­ï¼Œä½¿ç”¨**å®¹å™¨å**ï¼›å¦‚æœåœ¨**é»˜è®¤bridgeç½‘ç»œ**ï¼Œé€šå¸¸éœ€ä½¿ç”¨IPåœ°å€æˆ–`--link`ï¼ˆä¸æ¨èï¼Œä¼ ç»Ÿæ–¹å¼ï¼‰ã€‚
4.  **è§„åˆ’ç½‘ç»œç»“æ„**ï¼šäº‹å…ˆè§„åˆ’å¥½å®¹å™¨éœ€è¦å¦‚ä½•é€šä¿¡ã€‚å¦‚æœéœ€è¦å¤–éƒ¨è®¿é—®ï¼Œä¸€å®šè®°å¾—ç”¨ `-p` å‘å¸ƒç«¯å£ã€‚

# ğŸ“Š è°ƒè¯•Dockerç½‘ç»œå¸¸ç”¨å‘½ä»¤

è¿™é‡Œæœ‰ä¸€äº›å‘½ä»¤å¯ä»¥å¸®åŠ©ä½ è°ƒè¯•ï¼š

```bash
# æŸ¥çœ‹Dockerç½‘ç»œåˆ—è¡¨
docker network ls

# æŸ¥çœ‹ç‰¹å®šç½‘ç»œï¼ˆå¦‚sitiï¼‰çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿æ¥çš„å®¹å™¨åŠå…¶IP
docker network inspect siti

# æŸ¥çœ‹å®¹å™¨ï¼ˆå¦‚mysql2ï¼‰çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç½‘ç»œè®¾ç½®å’ŒIPåœ°å€
docker inspect mysql2

# æŸ¥çœ‹å®¿ä¸»æœºå½“å‰çš„ç½‘ç»œæ¥å£å’ŒIPåœ°å€é…ç½®
ip addr show

# æµ‹è¯•ä»å®¿ä¸»æœºåˆ°å®¹å™¨IPç«¯å£çš„è¿é€šæ€§ï¼ˆæ›¿æ¢ä¸ºä½ çš„å®¹å™¨IPï¼‰
telnet 172.18.0.3 3306  # éœ€è¦å…ˆå®‰è£…telnet: yum install -y telnet
# æˆ–è€…ä½¿ç”¨ncå‘½ä»¤
nc -zv 172.18.0.3 3306
```

å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®ä½ è§£å†³é—®é¢˜ã€‚


# 2. 

# è§£å†³ MySQL è¿æ¥ä¸­ localhost ä¸ 127.0.0.1 çš„åŒºåˆ«é—®é¢˜

ä½ é‡åˆ°çš„æƒ…å†µéå¸¸ç»å…¸ï¼Œå®ƒæ­ç¤ºäº† MySQL å®¢æˆ·ç«¯è¿æ¥è¡Œä¸ºçš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼š**`localhost` å’Œ `127.0.0.1` åœ¨ MySQL è¿æ¥ä¸­æœ‰ä¸åŒçš„å«ä¹‰**ã€‚

## é—®é¢˜åŸå› åˆ†æ

### 1. localhost ä¸ 127.0.0.1 çš„åŒºåˆ«

- **ä½¿ç”¨ `localhost` è¿æ¥æ—¶**ï¼š
  MySQL å®¢æˆ·ç«¯ä¼šå°è¯•ä½¿ç”¨ **Unix å¥—æ¥å­—ï¼ˆsocketï¼‰** è€Œä¸æ˜¯ TCP/IP è¿æ¥
  - é»˜è®¤æŸ¥æ‰¾çš„ socket æ–‡ä»¶è·¯å¾„æ˜¯ `/tmp/mysql.sock` æˆ– `/var/lib/mysql/mysql.sock`
  - ä½ çš„é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºå®ƒå°è¯•ä½¿ç”¨ `/tmp/mysql80.sock`
  - è¿™ç§æ–¹å¼**ä¸ç»è¿‡ç½‘ç»œæ ˆ**ï¼Œé€Ÿåº¦æ›´å¿«ä½†åªèƒ½è¿æ¥æœ¬åœ° MySQL å®ä¾‹

- **ä½¿ç”¨ `127.0.0.1` è¿æ¥æ—¶**ï¼š
  MySQL å®¢æˆ·ç«¯ä¼šä½¿ç”¨ **TCP/IP è¿æ¥**
  - é€šè¿‡ç½‘ç»œå›ç¯æ¥å£å»ºç«‹è¿æ¥
  - è¿™ç§æ–¹å¼ä¼š**ä½¿ç”¨ç«¯å£æ˜ å°„**ï¼Œå› æ­¤å¯ä»¥è¿æ¥åˆ° Docker å®¹å™¨ä¸­çš„ MySQL

### 2. ä¸ºä»€ä¹ˆåœ¨ Docker ç¯å¢ƒä¸­ä¼šå‡ºç°è¿™ç§å·®å¼‚

åœ¨ Docker ç¯å¢ƒä¸­ï¼š
- MySQL æœåŠ¡è¿è¡Œåœ¨å®¹å™¨å†…éƒ¨
- ä½ ä½¿ç”¨ `-p 3307:3306` å°†å®¹å™¨çš„ 3306 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 3307 ç«¯å£
- è¿™ç§ç«¯å£æ˜ å°„**åªå¯¹ TCP/IP è¿æ¥æœ‰æ•ˆ**
- Unix socket è¿æ¥æ— æ³•é€šè¿‡è¿™ç§æ˜ å°„å·¥ä½œï¼Œå› ä¸ºå®ƒä¸ç»è¿‡ç½‘ç»œæ¥å£

## è§£å†³æ–¹æ¡ˆ

### 1. å§‹ç»ˆä½¿ç”¨ 127.0.0.1 è€Œä¸æ˜¯ localhostï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç®€å•ç›´æ¥çš„è§£å†³æ–¹æ¡ˆï¼š
```bash
mysql80 -uroot -h127.0.0.1 -P3307 -p
```

### 2. å¼ºåˆ¶ä½¿ç”¨ TCP åè®®

ä½ å¯ä»¥é€šè¿‡æ·»åŠ  `--protocol=TCP` å‚æ•°å¼ºåˆ¶ä½¿ç”¨ TCP è¿æ¥ï¼š
```bash
mysql80 -uroot -hlocalhost -P3307 -p --protocol=TCP
```

### 3. ä¿®æ”¹ MySQL å®¢æˆ·ç«¯é…ç½®

ä½ å¯ä»¥åœ¨ MySQL å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ `~/.my.cnf`ï¼‰ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```ini
[client]
protocol = TCP
```
è¿™æ ·é…ç½®åï¼Œå³ä½¿ä½¿ç”¨ `localhost` ä¹Ÿä¼šå¼ºåˆ¶ä½¿ç”¨ TCP è¿æ¥ã€‚

## æ·±å…¥ç†è§£

### MySQL è¿æ¥æ–¹å¼å¯¹æ¯”

| è¿æ¥æ–¹å¼ | ä½¿ç”¨åœºæ™¯ | Docker ç¯å¢ƒé€‚ç”¨æ€§ | æ€§èƒ½ |
|---------|---------|------------------|------|
| `127.0.0.1` (TCP/IP) | è¿œç¨‹æˆ–æœ¬åœ°ç½‘ç»œè¿æ¥ | âœ… é€‚ç”¨ | ç¨æ…¢ |
| `localhost` (Unix Socket) | ä»…æœ¬åœ°è¿æ¥ | âŒ ä¸é€‚ç”¨ | æ›´å¿« |

### ä¸ºä»€ä¹ˆè®¾è®¡è¿™æ ·çš„åŒºåˆ«

è¿™ç§è®¾è®¡ä¸»è¦æ˜¯å‡ºäºæ€§èƒ½è€ƒè™‘ï¼š
1. Unix socket è¿æ¥ä¸éœ€è¦ç»è¿‡ç½‘ç»œåè®®æ ˆï¼Œé€Ÿåº¦æ›´å¿«
2. åœ¨çº¯ç²¹æœ¬åœ°ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ socket å¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½
3. ä½†åœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸­ï¼Œè¿™ç§åŒºåˆ«å¯¼è‡´äº†è¿æ¥æ–¹å¼çš„å¤æ‚æ€§

## å®è·µå»ºè®®

1. **åœ¨ Docker ç¯å¢ƒä¸­å§‹ç»ˆä½¿ç”¨ `127.0.0.1`** è€Œä¸æ˜¯ `localhost`
2. **æ˜ç¡®æŒ‡å®šåè®®** å½“éœ€è¦ç¡®ä¿è¿æ¥æ–¹å¼æ—¶
3. **æ£€æŸ¥ç«¯å£æ˜ å°„** ç¡®ä¿ `-p` å‚æ•°æ­£ç¡®è®¾ç½®
4. **éªŒè¯è¿æ¥** ä½¿ç”¨ `telnet 127.0.0.1 3307` æµ‹è¯•ç«¯å£æ˜¯å¦å¼€æ”¾

## æ€»ç»“

ä½ é‡åˆ°çš„é—®é¢˜ä¸æ˜¯é…ç½®é”™è¯¯ï¼Œè€Œæ˜¯ MySQL å®¢æˆ·ç«¯è¿æ¥æœºåˆ¶çš„ç‰¹æ€§ã€‚åœ¨ Docker ç¯å¢ƒä¸­ï¼Œç”±äºç«¯å£æ˜ å°„åªå¯¹ TCP/IP è¿æ¥æœ‰æ•ˆï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨ `127.0.0.1` è€Œä¸æ˜¯ `localhost` æ¥è¿æ¥æ˜ å°„çš„ç«¯å£ã€‚

è¿™ç§åŒºåˆ«åœ¨å®¹å™¨åŒ–éƒ¨ç½²ä¸­å¾ˆå¸¸è§ï¼Œç†è§£å®ƒæœ‰åŠ©äºé¿å…ç±»ä¼¼çš„è¿æ¥é—®é¢˜ã€‚ä½ ç°åœ¨å¯ä»¥ç»§ç»­ä½¿ç”¨ `mysql80 -uroot -h127.0.0.1 -P3307 -p` æ¥æˆåŠŸè¿æ¥ä½ çš„ MySQL å®¹å™¨ã€‚

# 3. 

# Docker ç½‘ç»œä¼˜åŒ–ï¼šå…¸å‹åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ

åœ¨ Docker ç½‘ç»œä¼˜åŒ–ä¸­ï¼Œæœ‰è®¸å¤šå…¸å‹æƒ…å†µå’Œæœ€ä½³å®è·µã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¨é¢çš„æŒ‡å—ï¼Œæ¶µç›–äº†å„ç§ç½‘ç»œä¼˜åŒ–åœºæ™¯ï¼š

## ğŸŒ ä¸€ã€ç½‘ç»œé©±åŠ¨é€‰æ‹©ä¼˜åŒ–

### 1. ä¸åŒç½‘ç»œé©±åŠ¨é€‚ç”¨åœºæ™¯

| ç½‘ç»œé©±åŠ¨ | é€‚ç”¨åœºæ™¯ | æ€§èƒ½ç‰¹ç‚¹ | ä½¿ç”¨å»ºè®® |
|---------|---------|---------|---------|
| **bridge** | å•ä¸»æœºå®¹å™¨é€šä¿¡ | ä¸­ç­‰æ€§èƒ½ï¼ŒNATè½¬å‘ | é»˜è®¤é€‰æ‹©ï¼Œé€‚åˆå¤§å¤šæ•°å•æœºåœºæ™¯ |
| **host** | é«˜æ€§èƒ½éœ€æ±‚ | æœ€ä½³æ€§èƒ½ï¼Œç›´æ¥ä½¿ç”¨ä¸»æœºç½‘ç»œ | å¯¹ç½‘ç»œæ€§èƒ½è¦æ±‚æé«˜çš„åº”ç”¨ |
| **overlay** | å¤šä¸»æœºå®¹å™¨é€šä¿¡ | è¾ƒå¥½æ€§èƒ½ï¼Œè·¨ä¸»æœºç½‘ç»œ | Swarmé›†ç¾¤æˆ–å¤šä¸»æœºç¯å¢ƒ |
| **macvlan** | å®¹å™¨éœ€è¦ç‹¬ç«‹IP | æä½³æ€§èƒ½ï¼Œç›´æ¥åˆ†é…MACåœ°å€ | å®¹å™¨éœ€è¦ç›´æ¥æš´éœ²åœ¨ç½‘ç»œä¸­ |
| **ipvlan** | é«˜å¯†åº¦å®¹å™¨éƒ¨ç½² | æä½³æ€§èƒ½ï¼Œå…±äº«MACåœ°å€ | éœ€è¦å¤§é‡å®¹å™¨ä¸”æ¯ä¸ªéƒ½éœ€è¦ç‹¬ç«‹IP |

### 2. ç½‘ç»œé©±åŠ¨é€‰æ‹©ç¤ºä¾‹
```bash
# ä½¿ç”¨hostç½‘ç»œæ¨¡å¼ï¼ˆé«˜æ€§èƒ½ï¼‰
docker run -d --name nginx --network host nginx

# åˆ›å»ºmacvlanç½‘ç»œ
docker network create -d macvlan \
  --subnet=192.168.1.0/24 \
  --gateway=192.168.1.1 \
  -o parent=eth0 \
  my-macvlan-net

# ä½¿ç”¨macvlanç½‘ç»œ
docker run -d --name app --network my-macvlan-net my-app
```

## ğŸ”§ äºŒã€DNSä¸æœåŠ¡å‘ç°ä¼˜åŒ–

### 1. å®¹å™¨åç§°è§£æä¼˜åŒ–
```bash
# åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼ˆè‡ªåŠ¨æä¾›DNSè§£æï¼‰
docker network create my-network

# å¯åŠ¨å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨å®¹å™¨åç›´æ¥è®¿é—®
docker run -d --name web --network my-network nginx
docker run -d --name app --network my-network my-app

# åœ¨appå®¹å™¨ä¸­å¯ä»¥ç›´æ¥ping web
docker exec app ping web
```

### 2. è‡ªå®šä¹‰DNSé…ç½®
```bash
# ä½¿ç”¨è‡ªå®šä¹‰DNSæœåŠ¡å™¨
docker run -d --name my-container \
  --dns 8.8.8.8 \
  --dns-search example.com \
  nginx

# æˆ–è€…ä½¿ç”¨docker daemonçš„å…¨å±€DNSé…ç½®
# åœ¨/etc/docker/daemon.jsonä¸­æ·»åŠ ï¼š
{
  "dns": ["8.8.8.8", "8.8.4.4"],
  "dns-search": ["example.com"]
}
```

## âš¡ ä¸‰ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ç½‘ç»œMTUä¼˜åŒ–
```bash
# æ£€æŸ¥å½“å‰MTUè®¾ç½®
ip link show | grep mtu

# åˆ›å»ºç½‘ç»œæ—¶æŒ‡å®šMTU
docker network create --opt com.docker.network.driver.mtu=1500 my-network

# å¯¹äºoverlayç½‘ç»œï¼Œå¯èƒ½éœ€è¦è°ƒæ•´MTUä»¥é€‚åº”åº•å±‚ç½‘ç»œ
docker network create -d overlay \
  --opt com.docker.network.driver.mtu=1450 \
  my-overlay-net
```

### 2. å®¹å™¨ç½‘ç»œæ€§èƒ½è°ƒä¼˜
```bash
# é™åˆ¶å®¹å™¨å¸¦å®½
docker run -d --name limited-container \
  --network my-network \
  --device-read-bps /dev/null:1mb \
  --device-write-bps /dev/null:1mb \
  nginx

# ä½¿ç”¨tcï¼ˆTraffic Controlï¼‰è¿›è¡Œé«˜çº§æµé‡æ§åˆ¶
# éœ€è¦åœ¨ä¸»æœºä¸Šé…ç½®
```

## ğŸ”’ å››ã€å®‰å…¨ä¼˜åŒ–ç­–ç•¥

### 1. ç½‘ç»œéš”ç¦»ä¸å®‰å…¨ç»„
```bash
# åˆ›å»ºå†…éƒ¨ç½‘ç»œï¼ˆä¸è¿æ¥åˆ°ä¸»æœºï¼‰
docker network create --internal my-internal-network

# å¯ç”¨ç½‘ç»œåŠ å¯†ï¼ˆoverlayç½‘ç»œï¼‰
docker network create -d overlay \
  --opt encrypted \
  my-encrypted-network

# ä½¿ç”¨ç½‘ç»œæ ‡ç­¾è¿›è¡Œå®‰å…¨åˆ†ç»„
docker network create --label security=high secure-network
```

### 2. é˜²ç«å¢™è§„åˆ™ä¼˜åŒ–
```bash
# ä½¿ç”¨iptablesè§„åˆ™é™åˆ¶å®¹å™¨è®¿é—®
# åªå…è®¸ç‰¹å®šå®¹å™¨è®¿é—®æ•°æ®åº“
iptables -A DOCKER-USER -s 172.18.0.0/16 -d 172.18.0.2 -p tcp --dport 3306 -j ACCEPT
iptables -A DOCKER-USER -d 172.18.0.2 -p tcp --dport 3306 -j DROP

# åˆ›å»ºè‡ªå®šä¹‰iptablesé“¾ç®¡ç†Dockeræµé‡
```

## ğŸ“Š äº”ã€å¤šä¸»æœºç½‘ç»œä¼˜åŒ–

### 1. Overlayç½‘ç»œä¼˜åŒ–
```bash
# åˆ›å»ºä¼˜åŒ–çš„overlayç½‘ç»œ
docker network create -d overlay \
  --subnet 10.10.0.0/16 \
  --opt com.docker.network.driver.overlay.vxlanid=4096 \
  --opt com.docker.network.driver.overlay.arps=true \
  my-optimized-overlay

# é…ç½®è´Ÿè½½å‡è¡¡
docker service create --name web \
  --network my-optimized-overlay \
  --replicas 3 \
  -p 80:80 \
  nginx
```

### 2. ç½‘ç»œæ’ä»¶ä½¿ç”¨
```bash
# ä½¿ç”¨Calicoç½‘ç»œæ’ä»¶ï¼ˆéœ€è¦å…ˆå®‰è£…ï¼‰
docker network create -d calico --ipam-driver calico-ipam calico-net

# ä½¿ç”¨Weaveç½‘ç»œæ’ä»¶
weave launch
docker run -d --name app --net weave my-app
```

## ğŸš€ å…­ã€ç›‘æ§ä¸è¯Šæ–­ä¼˜åŒ–

### 1. ç½‘ç»œç›‘æ§å·¥å…·
```bash
# ä½¿ç”¨å†…ç½®å‘½ä»¤ç›‘æ§
docker network ls
docker network inspect my-network

# ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·
# å®‰è£…weave scopeè¿›è¡Œå¯è§†åŒ–ç›‘æ§
curl -L git.io/scope -o /usr/local/bin/scope
chmod a+x /usr/local/bin/scope
scope launch

# ä½¿ç”¨cAdvisorç›‘æ§ç½‘ç»œæµé‡
docker run -d \
  --name=cadvisor \
  --volume=/:/rootfs:ro \
  --volume=/var/run:/var/run:ro \
  --volume=/sys:/sys:ro \
  --volume=/var/lib/docker/:/var/lib/docker:ro \
  --publish=8080:8080 \
  google/cadvisor:latest
```

### 2. ç½‘ç»œè¯Šæ–­æŠ€å·§
```bash
# æ£€æŸ¥å®¹å™¨ç½‘ç»œè¿æ¥
docker exec -it container-name ping google.com

# ä½¿ç”¨nsenterè¿›å…¥å®¹å™¨ç½‘ç»œå‘½åç©ºé—´
nsenter -t $(docker inspect -f '{{.State.Pid}}' container-name) -n ip addr

# ä½¿ç”¨tcpdumpæŠ“å–å®¹å™¨ç½‘ç»œåŒ…
docker run -d --name tcpdump --net container:target-container nicolaka/netshoot \
  tcpdump -i any -w /capture.pcap

# æ£€æŸ¥ç«¯å£æ˜ å°„å’Œè¿æ¥
netstat -tulnp | grep docker
ss -tulnp | grep docker
```

## ğŸ”„ ä¸ƒã€ç‰¹æ®Šåœºæ™¯ä¼˜åŒ–

### 1. é«˜å¯ç”¨æ€§ç½‘ç»œé…ç½®
```bash
# åˆ›å»ºå¤šä¸ªç½‘ç»œæ¥å£æé«˜å¯é æ€§
docker network create net1
docker network create net2

docker run -d --name my-app \
  --network net1 \
  --network net2 \
  my-app

# ä½¿ç”¨å¥åº·æ£€æŸ¥ç¡®ä¿ç½‘ç»œå¯ç”¨æ€§
docker run -d --name health-checked \
  --health-cmd="curl -f http://localhost || exit 1" \
  --health-interval=30s \
  nginx
```

### 2. IPv6æ”¯æŒä¼˜åŒ–
```bash
# å¯ç”¨IPv6æ”¯æŒï¼ˆåœ¨daemon.jsonä¸­ï¼‰
{
  "ipv6": true,
  "fixed-cidr-v6": "2001:db8:1::/64"
}

# åˆ›å»ºIPv6ç½‘ç»œ
docker network create --ipv6 --subnet=2001:db8:1::/64 ipv6-network
```

### 3. ç½‘ç»œèµ„æºæ¸…ç†ä¼˜åŒ–
```bash
# å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„ç½‘ç»œ
docker network prune

# æ¸…ç†ç‰¹å®šç±»å‹çš„æœªä½¿ç”¨èµ„æº
docker system prune --volumes --filter "until=24h"

# è‡ªåŠ¨æ¸…ç†è„šæœ¬
#!/bin/bash
# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œã€å®¹å™¨ã€é•œåƒå’Œå·
docker system prune -af --volumes
```

## ğŸ’¡ å…«ã€æœ€ä½³å®è·µæ€»ç»“

1. **é€‰æ‹©åˆé€‚çš„ç½‘ç»œé©±åŠ¨**ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©bridgeã€hostã€overlayæˆ–macvlan
2. **ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œ**ï¼šé¿å…ä½¿ç”¨é»˜è®¤bridgeç½‘ç»œï¼Œæä¾›æ›´å¥½çš„DNSè§£æ
3. **åˆç†è§„åˆ’IPåœ°å€**ï¼šä½¿ç”¨é€‚å½“çš„å­ç½‘å¤§å°ï¼Œé¿å…IPå†²çª
4. **å®æ–½ç½‘ç»œå®‰å…¨ç­–ç•¥**ï¼šä½¿ç”¨ç½‘ç»œéš”ç¦»ã€é˜²ç«å¢™è§„åˆ™å’ŒåŠ å¯†
5. **ç›‘æ§ç½‘ç»œæ€§èƒ½**ï¼šå®šæœŸæ£€æŸ¥ç½‘ç»œæµé‡å’Œè¿æ¥çŠ¶æ€
6. **ä¼˜åŒ–MTUè®¾ç½®**ï¼šæ ¹æ®åº•å±‚ç½‘ç»œè°ƒæ•´MTUå¤§å°
7. **å®æ–½é«˜å¯ç”¨æ–¹æ¡ˆ**ï¼šä¸ºå…³é”®æœåŠ¡é…ç½®å¤šç½‘ç»œæ¥å£å’Œå¥åº·æ£€æŸ¥
8. **å®šæœŸæ¸…ç†èµ„æº**ï¼šç§»é™¤æœªä½¿ç”¨çš„ç½‘ç»œå’Œå®¹å™¨ï¼Œé‡Šæ”¾èµ„æº

è¿™äº›ä¼˜åŒ–ç­–ç•¥æ¶µç›–äº†Dockerç½‘ç»œçš„å„ç§å…¸å‹åœºæ™¯ï¼Œä»åŸºç¡€é…ç½®åˆ°é«˜çº§ä¼˜åŒ–ï¼Œåº”è¯¥èƒ½å¸®åŠ©ä½ è§£å†³å¤§å¤šæ•°ç½‘ç»œç›¸å…³çš„é—®é¢˜ã€‚


