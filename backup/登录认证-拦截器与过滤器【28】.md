
# 1. ç™»å½•ä¸æ‹¦æˆªå™¨ SSMå¦‚ä½•å®ç°

```plain text
å›¾ç‰‡ä¸­æ˜¯SSMæ¡†æ¶ä¸­å¯¹ç”¨æˆ·ç™»å½•ä»¥åŠç™»å½•æ‹¦æˆªå™¨çš„æ ¸å¿ƒä»£ç ï¼Œè¯·å¯¹å…¶åšå‡ºå…¨æ–¹ä½è¯„ä»·ï¼ˆå®‰å…¨æ€§ã€æ‰©å±•æ€§ï¼ˆåç«¯æœåŠ¡å™¨ã€å•ä½“æœåŠ¡å™¨ï¼‰ç­‰ç»´åº¦è¶Šå…¨è¶Šå¥½ï¼‰ã€‚
ï¼ˆæ³¨ï¼šä¹‹åæˆ‘ä¼šæé—®ç›®å‰æµè¡Œçš„ç™»å½•åŠå…¶ç™»å½•æ‹¦æˆªçš„æŠ€æœ¯æœ‰å“ªäº›ï¼Œä»¥åŠåº”ç”¨åœºæ™¯ã€å®‰å…¨æ€§ã€å¯æ‰©å±•æ€§ï¼‰
```

> å¥½çš„ï¼Œç”¨æˆ·ä¸Šä¼ äº†ä¸€ä¸ªSSMæ¡†æ¶ä¸­çš„ç™»å½•å’Œæ‹¦æˆªå™¨ä»£ç æ–‡ä»¶ï¼Œå¸Œæœ›æˆ‘è¿›è¡Œå…¨æ–¹ä½è¯„ä»·ï¼Œç‰¹åˆ«æ˜¯å®‰å…¨æ€§å’Œæ‰©å±•æ€§æ–¹é¢ã€‚ç”¨æˆ·è¿˜æåˆ°ä¹‹åä¼šè¯¢é—®å½“å‰æµè¡Œçš„ç™»å½•æŠ€æœ¯ï¼Œè¯´æ˜ä»–å¯èƒ½æ­£åœ¨åšæŠ€æœ¯é€‰å‹æˆ–ç³»ç»Ÿå‡çº§ã€‚
>
> ä»ä»£ç å†…å®¹æ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„SSMä¼ ç»Ÿç™»å½•å®ç°ã€‚ç”¨æˆ·æ§åˆ¶å™¨å¤„ç†ç™»å½•è¯·æ±‚ï¼ŒéªŒè¯æˆåŠŸåæŠŠç”¨æˆ·å¯¹è±¡å­˜å…¥Sessionï¼›æ‹¦æˆªå™¨æ£€æŸ¥Sessionä¸­æ˜¯å¦å­˜åœ¨ç”¨æˆ·ä¿¡æ¯æ¥åˆ¤æ–­æ˜¯å¦ç™»å½•ã€‚è¿™ç§å®ç°æ–¹å¼åœ¨ä¼ ç»Ÿå•ä½“åº”ç”¨ä¸­å¾ˆå¸¸è§ï¼Œä½†å­˜åœ¨æ˜æ˜¾çš„å®‰å…¨å’Œæ‰©å±•æ€§é—®é¢˜ã€‚
>
> å®‰å…¨æ€§æ–¹é¢é—®é¢˜æœ€ä¸ºçªå‡ºï¼šæ²¡æœ‰å¯†ç åŠ å¯†å­˜å‚¨å’Œä¼ è¾“ï¼ˆæ˜æ–‡å¯†ç ï¼‰ã€ç¼ºä¹é˜²æš´åŠ›ç ´è§£æœºåˆ¶ã€Sessionå›ºå®šåŒ–æ”»å‡»é£é™©ã€æ²¡æœ‰CSRFä¿æŠ¤ã€æ•æ„Ÿä¿¡æ¯ç›´æ¥å­˜å‚¨åœ¨Sessionä¸­ã€‚è¿™äº›å®‰å…¨é—®é¢˜åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ç»å¯¹ä¸èƒ½æ¥å—çš„ã€‚
>
> æ‰©å±•æ€§æ–¹é¢ï¼Œè¿™ç§åŸºäºSessionçš„è®¤è¯æ–¹å¼åœ¨å•ä½“æ¶æ„ä¸­å‹‰å¼ºå¯ç”¨ï¼Œä½†å®Œå…¨ä¸é€‚åˆåˆ†å¸ƒå¼æˆ–å¾®æœåŠ¡æ¶æ„ã€‚Sessionçš„å­˜å‚¨å’ŒåŒæ­¥ä¼šæˆä¸ºä¸¥é‡ç“¶é¢ˆï¼Œä¹Ÿæ— æ³•æ”¯æŒè·¨è¯­è¨€ç³»ç»Ÿé›†æˆã€‚
>
> ç”¨æˆ·å¯èƒ½æ˜¯ä¸€ä¸ªæ­£åœ¨ç»´æŠ¤ä¼ ç»ŸSSMç³»ç»Ÿçš„å¼€å‘è€…ï¼Œç°åœ¨æ­£åœ¨è€ƒè™‘ç³»ç»Ÿçš„å®‰å…¨åŠ å›ºå’Œæ¶æ„æ¼”è¿›ã€‚ä»–éœ€è¦äº†è§£å½“å‰æŠ€æœ¯çš„å±€é™æ€§ï¼Œä»¥åŠç°ä»£è®¤è¯æˆæƒçš„å®ç°æ–¹å¼ã€‚è€ƒè™‘åˆ°ä»–åç»­è¿˜æƒ³äº†è§£æµè¡ŒæŠ€æœ¯ï¼Œåº”è¯¥ä¸ºä»–å‡†å¤‡å¥½JWTã€OAuth2ã€Spring Securityç­‰ç°ä»£è§£å†³æ–¹æ¡ˆçš„å¯¹æ¯”åˆ†æã€‚
>
> åœ¨å›ç­”æ—¶ï¼Œæˆ‘éœ€è¦æ—¢æ˜ç¡®æŒ‡å‡ºå½“å‰ä»£ç çš„å®‰å…¨éšæ‚£å’Œæ‰©å±•æ€§é™åˆ¶ï¼Œåˆè¦ä¸ºåç»­ä»‹ç»ç°ä»£æŠ€æœ¯åšå¥½é“ºå«ï¼Œä¿æŒå›ç­”çš„ä¸“ä¸šæ€§å’Œå»ºè®¾æ€§ã€‚åŒæ—¶è¦æ³¨æ„é¿å…è¿‡äºæŠ€æœ¯æ·±åº¦çš„æœ¯è¯­ï¼Œç”¨ç›¸å¯¹æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šé—®é¢˜ã€‚

# ğŸ” SSMç™»å½•ä¸æ‹¦æˆªå™¨å®ç°å…¨æ–¹ä½è¯„ä»·

## âœ¨ æ ¸å¿ƒä»£ç æ¦‚è¿°åˆ†æ

æ‚¨æä¾›çš„ä»£ç å±•ç¤ºäº†SSMæ¡†æ¶ä¸­å…¸å‹çš„**åŸºäºSessionçš„ç™»å½•è®¤è¯**å’Œ**æ‹¦æˆªå™¨å®ç°**æ–¹å¼ï¼Œè¿™æ˜¯ä¼ ç»ŸJava Webåº”ç”¨å¸¸ç”¨çš„èº«ä»½éªŒè¯æ¨¡å¼ã€‚ä¸‹é¢æˆ‘ä»å¤šä¸ªç»´åº¦è¿›è¡Œå…¨é¢è¯„ä»·ã€‚

## ğŸ“Š å®‰å…¨æ€§è¯„ä¼°

### ğŸ”´ ä¸¥é‡å®‰å…¨é—®é¢˜

| å®‰å…¨é—®é¢˜ | é£é™©ç­‰çº§ | æè¿° |
| :--- | :--- | :--- |
| **æ˜æ–‡å¯†ç ä¼ è¾“ä¸å­˜å‚¨** | ğŸ”´ é«˜å± | å¯†ç ä»¥æ˜æ–‡å½¢å¼ä¼ è¾“å’ŒæŸ¥è¯¢ï¼Œææ˜“è¢«çªƒå– |
| **Sessionå›ºå®šåŒ–æ”»å‡»** | ğŸŸ¡ ä¸­å± | ç™»å½•åæœªé‡æ–°ç”ŸæˆSession IDï¼Œå­˜åœ¨å›ºå®šåŒ–æ”»å‡»é£é™© |
| **ç¼ºä¹é˜²æš´åŠ›ç ´è§£æœºåˆ¶** | ğŸŸ¡ ä¸­å± | æ— ç™»å½•å°è¯•æ¬¡æ•°é™åˆ¶ï¼Œæ˜“é­å—æš´åŠ›ç ´è§£ |
| **CSRFä¿æŠ¤ç¼ºå¤±** | ğŸŸ¡ ä¸­å± | æœªé›†æˆCSRFä»¤ç‰Œä¿æŠ¤ï¼Œå­˜åœ¨è·¨ç«™è¯·æ±‚ä¼ªé€ é£é™© |
| **æ•æ„Ÿä¿¡æ¯æ³„éœ²** | ğŸŸ¡ ä¸­å± | å°†å®Œæ•´Userå¯¹è±¡å­˜å‚¨åœ¨Sessionä¸­å¯èƒ½å¯¼è‡´ä¿¡æ¯æ³„éœ² |

### ğŸŸ¢ å®‰å…¨å®ç°ä¼˜ç‚¹

| ä¼˜ç‚¹ | è¯´æ˜ |
| :--- | :--- |
| **æ‹¦æˆªå™¨è·¯å¾„æ§åˆ¶** | æ­£ç¡®æ’é™¤äº†ç™»å½•æ¥å£çš„æ‹¦æˆªï¼Œé¿å…å¾ªç¯é‡å®šå‘ |
| **Sessionè¶…æ—¶å¤„ç†** | ä¾èµ–å®¹å™¨Sessionè¶…æ—¶æœºåˆ¶ï¼Œæä¾›åŸºæœ¬çš„å®‰å…¨ä¿æŠ¤ |

### ğŸ’¡ å®‰å…¨æ€§æ”¹è¿›å»ºè®®

```java
// å¯†ç åŠ å¯†å¤„ç†ç¤ºä¾‹
public String login(/* å‚æ•° */) {
    // å¯†ç åŠ å¯†å¤„ç†
    String encryptedPwd = DigestUtils.sha256Hex(password + salt);
    User user = userService.findUser(usercode, encryptedPwd);
    
    // ç™»å½•æˆåŠŸåé‡æ–°ç”ŸæˆSession IDé˜²æ­¢å›ºå®šåŒ–æ”»å‡»
    session.invalidate();
    session = request.getSession(true);
    
    // ä¸å­˜å‚¨å®Œæ•´ç”¨æˆ·å¯¹è±¡ï¼Œåªå­˜å‚¨å¿…è¦ä¿¡æ¯
    session.setAttribute("USER_ID", user.getId());
    session.setAttribute("USER_ROLE", user.getRole());
}
```

## ğŸ“ˆ æ‰©å±•æ€§è¯„ä¼°

### åç«¯æœåŠ¡å™¨æ‰©å±•æ€§

| æ–¹é¢ | è¯„ä»· | è¯´æ˜ |
| :--- | :--- | :--- |
| **æ°´å¹³æ‰©å±•èƒ½åŠ›** | ğŸ”´ å·® | åŸºäºSessionçš„è®¤è¯åœ¨é›†ç¾¤ç¯å¢ƒä¸‹éœ€è¦Sessionå¤åˆ¶æˆ–ç²˜æ€§ä¼šè¯ |
| **åˆ†å¸ƒå¼æ”¯æŒ** | ğŸ”´ å·® | æ— æ³•ç›´æ¥æ”¯æŒå¾®æœåŠ¡æ¶æ„ï¼ŒSessionéš¾ä»¥è·¨æœåŠ¡å…±äº« |
| **çŠ¶æ€ç®¡ç†** | ğŸ”´ å·® | æœ‰çŠ¶æ€è®¾è®¡ï¼ŒæœåŠ¡å™¨éœ€è¦ç»´æŠ¤ç”¨æˆ·Sessionä¿¡æ¯ |

### å•ä½“æœåŠ¡å™¨æ‰©å±•æ€§

| æ–¹é¢ | è¯„ä»· | è¯´æ˜ |
| :--- | :--- | :--- |
| **å•æœºæ€§èƒ½** | ğŸŸ¡ ä¸­ç­‰ | Sessionå†…å­˜å ç”¨éšç”¨æˆ·æ•°çº¿æ€§å¢é•¿ï¼Œå½±å“å•æœºæ€§èƒ½ |
| **å†…å­˜ç®¡ç†** | ğŸŸ¡ ä¸­ç­‰ | å¤§é‡ç”¨æˆ·åœ¨çº¿æ—¶å¯èƒ½é€ æˆå†…å­˜å‹åŠ›ï¼Œéœ€è¦åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´ |
| **ç»´æŠ¤æˆæœ¬** | ğŸŸ¢ è‰¯å¥½ | åœ¨å•ä½“æ¶æ„ä¸­å®ç°ç®€å•ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤ |

### ğŸ’¡ æ‰©å±•æ€§æ”¹è¿›å»ºè®®

```java
// å¼•å…¥åˆ†å¸ƒå¼Sessionå­˜å‚¨ï¼ˆå¦‚Redisï¼‰
@Configuration
@EnableRedisHttpSession
public class HttpSessionConfig {
    @Bean
    public LettuceConnectionFactory connectionFactory() {
        return new LettuceConnectionFactory();
    }
}

// æˆ–é‡‡ç”¨æ— çŠ¶æ€Tokenæ–¹æ¡ˆï¼ˆJWTï¼‰
public String login(/* å‚æ•° */) {
    // éªŒè¯æˆåŠŸåç”ŸæˆJWT Token
    String token = Jwts.builder()
        .setSubject(user.getId().toString())
        .claim("role", user.getRole())
        .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION_TIME))
        .signWith(SignatureAlgorithm.HS512, SECRET_KEY)
        .compact();
    
    response.setHeader("Authorization", "Bearer " + token);
    return "customer";
}
```

## ğŸ”§ ä»£ç è´¨é‡ä¸è®¾è®¡è¯„ä¼°

### ä»£ç ç»“æ„é—®é¢˜

| é—®é¢˜ | å½±å“ | å»ºè®® |
| :--- | :--- | :--- |
| **ç¡¬ç¼–ç URLè·¯å¾„** | å¯ç»´æŠ¤æ€§å·® | ä½¿ç”¨å¸¸é‡æˆ–é…ç½®ç®¡ç†URLè·¯å¾„ |
| **ç›´æ¥è½¬å‘JSPè·¯å¾„** | è€¦åˆæ€§é«˜ | åº”ä½¿ç”¨è§†å›¾è§£æå™¨é…ç½®ï¼Œé¿å…ç¡¬ç¼–ç  |
| **å¼‚å¸¸å¤„ç†ä¸å®Œå–„** | å¥å£®æ€§å·® | æ·»åŠ æ›´è¯¦ç»†çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½• |

### è®¾è®¡æ¨¡å¼é—®é¢˜

| é—®é¢˜ | å½±å“ | å»ºè®® |
| :--- | :--- | :--- |
| **ç´§è€¦åˆè®¾è®¡** | å¯æµ‹è¯•æ€§å·® | åº”ä¾èµ–æ¥å£è€Œéå®ç°ç±»ï¼Œæ–¹ä¾¿å•å…ƒæµ‹è¯• |
| **ç¼ºä¹åˆ†å±‚å¤„ç†** | èŒè´£ä¸æ¸… | è®¤è¯é€»è¾‘å¯æå–ä¸ºç‹¬ç«‹æœåŠ¡ç±» |

## ğŸŒ ç°ä»£æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯”

### å½“å‰ä¸»æµç™»å½•è®¤è¯æŠ€æœ¯

| æŠ€æœ¯æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | å®‰å…¨æ€§ | æ‰©å±•æ€§ | å¤æ‚åº¦ |
| :--- | :--- | :--- | :--- | :--- |
| **Session-Cookie** | ä¼ ç»Ÿå•ä½“åº”ç”¨ | ä¸­ | ä½ | ä½ |
| **JWT** | å‰åç«¯åˆ†ç¦»ã€å¾®æœåŠ¡ | é«˜ | é«˜ | ä¸­ |
| **OAuth 2.0** | ç¬¬ä¸‰æ–¹ç™»å½•ã€å¼€æ”¾å¹³å° | é«˜ | é«˜ | é«˜ |
| **SAML** | ä¼ä¸šå•ç‚¹ç™»å½• | é«˜ | é«˜ | é«˜ |

### æ‹¦æˆªå™¨/è¿‡æ»¤å™¨æ›¿ä»£æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
| :--- | :--- | :--- |
| **Spring Security** | åŠŸèƒ½å…¨é¢ï¼Œç¤¾åŒºæ´»è·ƒ | ä¼ä¸šçº§åº”ç”¨ï¼Œéœ€è¦å®Œæ•´å®‰å…¨æ–¹æ¡ˆ |
| **Shiro** | è½»é‡ç®€å•ï¼Œæ˜“äºé›†æˆ | ä¸­å°å‹é¡¹ç›®ï¼Œéœ€è¦è½»é‡çº§å®‰å…¨æ¡†æ¶ |
| **è‡ªå®šä¹‰æ‹¦æˆªå™¨** | çµæ´»å¯æ§ï¼Œå­¦ä¹ æˆæœ¬ä½ | ç®€å•éœ€æ±‚ï¼Œç‰¹å®šä¸šåŠ¡é€»è¾‘ |

## ğŸ’ ç»¼åˆæ€»ç»“ä¸å»ºè®®

### å½“å‰å®ç°è¯„ä»·æ€»ç»“

1. **å®‰å…¨æ€§**ï¼šğŸ”´ **ä¸åŠæ ¼** - å­˜åœ¨å¤šä¸ªä¸¥é‡å®‰å…¨æ¼æ´ï¼Œä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ
2. **æ‰©å±•æ€§**ï¼šğŸŸ¡ **æœ‰é™** - ä»…é€‚ç”¨äºå°å‹å•ä½“åº”ç”¨ï¼Œéš¾ä»¥æ‰©å±•è‡³åˆ†å¸ƒå¼ç¯å¢ƒ
3. **ç»´æŠ¤æ€§**ï¼šğŸŸ¡ **ä¸€èˆ¬** - å­˜åœ¨ç¡¬ç¼–ç å’Œç´§è€¦åˆé—®é¢˜ï¼Œä½†æ•´ä½“ç»“æ„æ¸…æ™°
4. **ç°ä»£åŒ–ç¨‹åº¦**ï¼šğŸ”´ **è½å** - åŸºäºä¼ ç»ŸSessionæ¨¡å¼ï¼Œæœªé‡‡ç”¨ç°ä»£è®¤è¯æ ‡å‡†

### è¿ç§»å»ºè®®è·¯å¾„

```mermaid
graph TD
    A[å½“å‰Sessionæ–¹æ¡ˆ] --> B[çŸ­æœŸåŠ å›º];
    A --> C[ä¸­æœŸæ”¹é€ ];
    A --> D[é•¿æœŸé‡æ„];
    
    B --> B1[æ·»åŠ å¯†ç åŠ å¯†];
    B --> B2[å®æ–½ç™»å½•é™åˆ¶];
    B --> B3[å¼•å…¥CSRFä¿æŠ¤];
    
    C --> C1[é›†æˆSpring Security];
    C --> C2[å®ç°åˆ†å¸ƒå¼Session];
    
    D --> D1[é‡‡ç”¨JWTæ— çŠ¶æ€è®¤è¯];
    D --> D2[å®ç°OAuth2.0é›†æˆ];
    D --> D3[æ„å»ºå¾®æœåŠ¡å®‰å…¨æ¶æ„];
```

**çŸ­æœŸå»ºè®®**ï¼šç«‹å³ä¿®å¤å®‰å…¨æ¼æ´ï¼Œè‡³å°‘æ·»åŠ å¯†ç åŠ å¯†å’Œç™»å½•å°è¯•é™åˆ¶
**ä¸­æœŸå»ºè®®**ï¼šå¼•å…¥Spring Securityæ¡†æ¶ï¼Œæå‡æ•´ä½“å®‰å…¨æ€§
**é•¿æœŸå»ºè®®**ï¼šæ ¹æ®æ¶æ„æ¼”è¿›æ–¹å‘ï¼Œé€‰æ‹©JWTæˆ–OAuth2.0æ–¹æ¡ˆ

æ‚¨æä¾›çš„ä»£ç å±•ç¤ºäº†ä¼ ç»Ÿçš„è®¤è¯å®ç°æ–¹å¼ï¼Œè™½ç„¶ç»“æ„æ¸…æ™°ä½†å­˜åœ¨æ˜æ˜¾çš„å®‰å…¨å’Œæ‰©å±•æ€§ç¼ºé™·ã€‚ç°ä»£åº”ç”¨å¼€å‘æ›´æ¨èä½¿ç”¨ä¸“ä¸šå®‰å…¨æ¡†æ¶å¦‚Spring Securityï¼Œæˆ–è€…é‡‡ç”¨æ— çŠ¶æ€çš„Tokenè®¤è¯æ–¹æ¡ˆã€‚

# 2. ç™»å½•åŠæ‹¦æˆªè®¤è¯å®ç°æ–¹å¼

```plain text
ç»§ç»­ä¸Šè¿°é—®é¢˜ï¼Œç›®å‰æµè¡Œçš„ç™»å½•åŠæ‹¦æˆªè®¤è¯å®ç°æ–¹å¼çš„æŠ€æœ¯æœ‰å“ªäº›ï¼ŒåŸç†ï¼ˆç»˜å›¾+è¯¦ç»†è§£é‡Šï¼‰ã€å®‰å…¨æ€§ã€æ¡ˆä¾‹ã€åº”ç”¨åœºæ™¯ã€å¯æ‰©å±•æ€§ï¼ˆé‡ç‚¹æ— çŠ¶æ€çš„Tokenè®¤è¯æ–¹æ¡ˆï¼‰ç­‰ç»´åº¦è¿›è¡Œå…¨æ–¹ä½è®²è§£
```

> å¥½çš„ï¼Œç”¨æˆ·æ­£åœ¨æ·±å…¥æ¢è®¨ç°ä»£èº«ä»½è®¤è¯æŠ€æœ¯ï¼Œå¸Œæœ›äº†è§£å½“å‰æµè¡Œçš„ç™»å½•åŠæ‹¦æˆªè®¤è¯å®ç°æ–¹å¼ï¼Œå¹¶è¦æ±‚ä»åŸç†ã€å®‰å…¨æ€§ã€åº”ç”¨åœºæ™¯ç­‰å¤šä¸ªç»´åº¦è¿›è¡Œå…¨æ–¹ä½è®²è§£ï¼Œç‰¹åˆ«æ˜¯è¦é‡ç‚¹ä»‹ç»æ— çŠ¶æ€çš„Tokenè®¤è¯æ–¹æ¡ˆã€‚
>
> è¿™æ˜¯ä¸€ä¸ªä¸“ä¸šæ€§å¾ˆå¼ºçš„é—®é¢˜ï¼Œæˆ‘éœ€è¦ç³»ç»Ÿåœ°æ•´ç†å„ç§ä¸»æµè®¤è¯æŠ€æœ¯ï¼Œå¹¶ç”¨æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼å‘ˆç°ç»™ç”¨æˆ·ã€‚æˆ‘è€ƒè™‘ä»å‡ ä¸ªæ ¸å¿ƒçš„è®¤è¯æ–¹æ¡ˆå…¥æ‰‹ï¼šJWTã€OAuth 2.0ã€OpenID Connectå’ŒSAMLï¼Œç„¶åæä¾›ä¸€ä¸ªç»¼åˆå¯¹æ¯”å’Œé€‰å‹å»ºè®®ã€‚
>
> æ ¹æ®æˆ‘çœ‹åˆ°çš„æœç´¢ç»“æœï¼Œ æä¾›äº†JWTçš„è¯¦ç»†ä»‹ç»ï¼ŒåŒ…æ‹¬å…¶ç»“æ„ã€å·¥ä½œæµç¨‹ã€ä¼˜åŠ¿å’ŒæŒ‘æˆ˜ã€‚ è¯¦ç»†ä»‹ç»äº†Spring Security OAuth2è®¤è¯æµç¨‹ï¼ŒåŒ…æ‹¬å››ç§æˆæƒæ¨¡å¼åŠå…¶é€‚ç”¨åœºæ™¯ã€‚ è§£é‡Šäº†OpenID Connectçš„åŸç†å’Œå®‰å…¨é—®é¢˜ï¼Œå®ƒæ˜¯å»ºç«‹åœ¨OAuth 2.0ä¹‹ä¸Šçš„èº«ä»½å±‚ã€‚ åˆ™ä»‹ç»äº†SAMLï¼Œè¿™æ˜¯ä¸€ç§åŸºäºXMLçš„æ ‡å‡†ï¼Œä¸»è¦ç”¨äºä¼ä¸šçº§å•ç‚¹ç™»å½•ã€‚
>
> æˆ‘æ‰“ç®—å…ˆä¸ºè¿™äº›è®¤è¯æŠ€æœ¯æä¾›ä¸€ä¸ªæ•´ä½“çš„æ¡†æ¶å›¾ï¼Œå±•ç¤ºå®ƒä»¬ä¹‹é—´çš„å…³ç³»å’Œå…¸å‹å·¥ä½œæµç¨‹ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©ç”¨æˆ·ç›´è§‚ç†è§£ã€‚ç„¶åæˆ‘ä¼šè¯¦ç»†è®²è§£æ¯ç§æŠ€æœ¯çš„åŸç†ã€å®‰å…¨æ€§ã€åº”ç”¨åœºæ™¯å’Œæ¡ˆä¾‹ï¼Œç‰¹åˆ«æ˜¯å¼ºè°ƒæ— çŠ¶æ€Tokenè®¤è¯æ–¹æ¡ˆçš„ç‰¹ç‚¹ã€‚
>
> å¯¹äºJWTï¼Œæˆ‘ä¼šé‡ç‚¹ä»‹ç»å…¶æ— çŠ¶æ€ç‰¹æ€§ å’Œç»“æ„ç»„æˆï¼Œä»¥åŠå®ƒåœ¨å¾®æœåŠ¡æ¶æ„ä¸­çš„åº”ç”¨ã€‚åŒæ—¶ä¹Ÿä¼šæŒ‡å‡ºå®ƒçš„æŒ‘æˆ˜ï¼Œå¦‚ä»¤ç‰Œæ³¨é”€å›°éš¾çš„é—®é¢˜ã€‚
>
> å¯¹äºOAuth 2.0ï¼Œæˆ‘ä¼šè¯¦ç»†è¯´æ˜å®ƒçš„å››ç§æˆæƒæ¨¡å¼ å’Œå…¸å‹æµç¨‹ï¼Œç‰¹åˆ«å¼ºè°ƒæˆæƒç æ¨¡å¼çš„å®‰å…¨æ€§ã€‚
>
> å¯¹äºOpenID Connectï¼Œæˆ‘ä¼šè§£é‡Šå®ƒå¦‚ä½•å»ºç«‹åœ¨OAuth 2.0ä¹‹ä¸Šå¹¶æ·»åŠ èº«ä»½è®¤è¯åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯ID Tokençš„æ¦‚å¿µå’Œä½¿ç”¨æ–¹å¼ã€‚
>
> å¯¹äºSAMLï¼Œæˆ‘ä¼šä»‹ç»å®ƒåœ¨ä¼ä¸šå•ç‚¹ç™»å½•ä¸­çš„ä¼ ç»Ÿä¼˜åŠ¿ï¼Œä»¥åŠå…¶åŸºäºXMLçš„ç»“æ„ç‰¹ç‚¹ã€‚
>
> æœ€åæˆ‘ä¼šæä¾›ä¸€ä¸ªå…¨é¢çš„å¯¹æ¯”è¡¨æ ¼ï¼Œä»å¤šä¸ªç»´åº¦æ¯”è¾ƒè¿™äº›æŠ€æœ¯ï¼Œå¸®åŠ©ç”¨æˆ·æ ¹æ®è‡ªèº«éœ€æ±‚åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚æˆ‘è¿˜ä¼šæ ¹æ®å¸¸è§çš„åº”ç”¨åœºæ™¯ç»™å‡ºæŠ€æœ¯é€‰å‹å»ºè®®ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹æ— çŠ¶æ€Tokenè®¤è¯æ–¹æ¡ˆçš„æ‰©å±•æ€§ä¼˜åŠ¿è¿›è¡Œå¼ºè°ƒã€‚
>
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶è¿™äº›æœç´¢ç»“æœæä¾›äº†å¾ˆå¤šæœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œä½†æœ‰äº›å†…å®¹å¯èƒ½å·²ç»æœ‰äº›è¿‡æ—¶ï¼ˆå¦‚2023å¹´çš„å†…å®¹ï¼‰ï¼Œæˆ‘ä¼šç¡®ä¿æä¾›çš„å»ºè®®ç¬¦åˆå½“å‰çš„æœ€ä½³å®è·µã€‚å¯¹äºä¿¡æ¯è¿‡å°‘æˆ–ç¼ºä¹ç›¸å…³æ€§çš„æœç´¢ç»“æœï¼Œæˆ‘ä¼šè°¨æ…å‚è€ƒæˆ–ä¸äºˆé‡‡ç”¨ã€‚

äº†è§£äº†æ‚¨å¯¹ç°ä»£ç™»å½•å’Œè®¤è¯æŠ€æœ¯çš„å…³æ³¨ã€‚æ‚¨ä¹‹å‰æä¾›çš„SSMç™»å½•æ‹¦æˆªå™¨ä»£ç å±äºä¼ ç»Ÿæ–¹å¼ï¼Œç¡®å®åœ¨æ‰©å±•æ€§å’Œå®‰å…¨æ€§æ–¹é¢æœ‰æ‰€æ¬ ç¼ºã€‚ç›®å‰ä¸»æµçš„è®¤è¯æŠ€æœ¯æ›´æ³¨é‡æ— çŠ¶æ€ã€åˆ†å¸ƒå¼å‹å¥½çš„æ–¹æ¡ˆã€‚

ä¸‹é¢æˆ‘å°†ä¸ºæ‚¨æ¢³ç†å‡ ç§æµè¡Œçš„ç™»å½•åŠæ‹¦æˆªè®¤è¯æŠ€æœ¯ï¼Œå¹¶ç”¨å›¾è¡¨å’Œæ–‡å­—è¯´æ˜å…¶åŸç†ã€å®‰å…¨æ€§ç­‰ã€‚

ä»¥ä¸‹æ˜¯è¿™äº›æŠ€æœ¯çš„å…³ç³»å’Œå…¸å‹å·¥ä½œæµç¨‹çš„æ€»ä½“è§†å›¾ï¼š

```mermaid
flowchart TD
    A[ç”¨æˆ·è®¿é—®å®¢æˆ·ç«¯] --> B{è®¤è¯æ–¹å¼}
    
    B -- ç®€å•APIè®¤è¯ --> C[JWTæ— çŠ¶æ€è®¤è¯]
    B -- ç¬¬ä¸‰æ–¹æˆæƒ/å•ç‚¹ç™»å½• --> D[OAuth 2.0]
    B -- ä¼ä¸šçº§å•ç‚¹ç™»å½• --> E[SAML 2.0]
    
    subgraph C_Flow [JWT æµç¨‹]
        C1[ç”¨æˆ·æäº¤å‡­è¯] --> C2[æœåŠ¡å™¨éªŒè¯å¹¶ç”ŸæˆJWT]
        C2 --> C3[å®¢æˆ·ç«¯æºå¸¦JWTè®¿é—®API]
        C3 --> C4[æœåŠ¡å™¨éªŒè¯JWTæœ‰æ•ˆæ€§]
    end
    
    subgraph D_Flow [OAuth 2.0 / OIDC æµç¨‹]
        D1[ç”¨æˆ·è¢«é‡å®šå‘è‡³æˆæƒæœåŠ¡å™¨] --> D2[ç”¨æˆ·æˆæƒå¹¶è¿”å›æˆæƒç ]
        D2 --> D3[å®¢æˆ·ç«¯ç”¨æˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œå’ŒIDä»¤ç‰Œ]
        D3 --> D4[å®¢æˆ·ç«¯ä½¿ç”¨ä»¤ç‰Œè®¿é—®èµ„æº]
    end
    
    subgraph E_Flow [SAML 2.0 æµç¨‹]
        E1[ç”¨æˆ·è®¿é—®æœåŠ¡æä¾›å•†SP] --> E2[SPé‡å®šå‘è‡³èº«ä»½æä¾›å•†IdP]
        E2 --> E3[ç”¨æˆ·åœ¨IdPè®¤è¯]
        E3 --> E4[IdPè¿”å›SAMLæ–­è¨€ç»™SP]
        E4 --> E5[SPåŸºäºæ–­è¨€åˆ›å»ºä¼šè¯]
    end
    
    C --> C_Flow
    D --> D_Flow
    E --> E_Flow
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¯¦ç»†äº†è§£ä¸€ä¸‹è¿™å‡ ç§æŠ€æœ¯ã€‚

### ğŸ”‘ 1. JWT (JSON Web Tokens)
JWTæ˜¯ä¸€ç§ç´§å‡‘çš„ã€URLå®‰å…¨çš„ä»¤ç‰Œï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚å®ƒé€šå¸¸ç”¨äº**æ— çŠ¶æ€è®¤è¯**ã€‚

#### åŸç†è¯¦è§£
*   **ç»“æ„**ï¼šJWTç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œç”¨ç‚¹å·è¿æ¥ï¼š
    *   **Header**ï¼šåŒ…å«ä»¤ç‰Œç±»å‹å’Œç­¾åç®—æ³•ï¼ˆå¦‚HMAC SHA256æˆ–RSAï¼‰ï¼Œç»è¿‡Base64Urlç¼–ç ã€‚
    *   **Payload**ï¼šåŒ…å«å£°æ˜ï¼ˆClaimsï¼‰ï¼Œå³å…³äºå®ä½“ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·ï¼‰å’Œé™„åŠ æ•°æ®çš„è¯­å¥ï¼Œä¾‹å¦‚ç”¨æˆ·IDã€è¿‡æœŸæ—¶é—´(`exp`)ã€ç­¾å‘è€…(`iss`)ç­‰ï¼Œä¹Ÿç»è¿‡Base64Urlç¼–ç ã€‚
    *   **Signature**ï¼šå¯¹ç¼–ç åçš„Headerã€ç¼–ç åçš„Payloadã€ä¸€ä¸ªå¯†é’¥ï¼ˆä½¿ç”¨Headerä¸­æŒ‡å®šçš„ç®—æ³•ï¼‰è¿›è¡Œç­¾åï¼Œç”¨äºéªŒè¯æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœªè¢«ç¯¡æ”¹ã€‚
    æœ€ç»ˆçš„JWTå½¢å¼ï¼š`aaaa.bbbb.cccc`
*   **å·¥ä½œæµç¨‹**ï¼š
    1.  ç”¨æˆ·ä½¿ç”¨å‡­è¯ï¼ˆå¦‚ç”¨æˆ·åå¯†ç ï¼‰ç™»å½•ã€‚
    2.  æœåŠ¡å™¨éªŒè¯å‡­è¯ï¼Œè‹¥æœ‰æ•ˆåˆ™ç”ŸæˆJWTï¼ˆé€šå¸¸åŒ…å«ç”¨æˆ·æ ‡è¯†å’Œæœ‰æ•ˆæœŸï¼‰å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚
    3.  å®¢æˆ·ç«¯åœ¨åç»­è¯·æ±‚çš„`Authorization`å¤´éƒ¨æºå¸¦JWTï¼ˆä¾‹å¦‚ï¼š`Bearer <token>`ï¼‰ã€‚
    4.  æœåŠ¡å™¨éªŒè¯JWTç­¾åï¼ˆéªŒè¯ä»¤ç‰Œå®Œæ•´æ€§å’Œæœ‰æ•ˆæ€§ï¼‰å¹¶è§£æPayloadä¸­çš„ä¿¡æ¯è¿›è¡Œæˆæƒï¼Œæ— éœ€æŸ¥è¯¢æ•°æ®åº“æˆ–ä¼šè¯å­˜å‚¨ï¼ˆé™¤ééœ€è¦é¢å¤–éªŒè¯ï¼‰ã€‚

#### å®‰å…¨æ€§
*   **ä¼˜ç‚¹**ï¼š**è‡ªåŒ…å«**ï¼šå‡å°‘äº†å¯¹æ•°æ®åº“çš„é¢‘ç¹æŸ¥è¯¢ã€‚**é˜²ç¯¡æ”¹**ï¼šç­¾åç¡®ä¿äº†ä»¤ç‰Œå®Œæ•´æ€§ã€‚
*   **é£é™©ä¸åº”å¯¹**ï¼š
    *   **ä»¤ç‰Œæ³„éœ²**ï¼šä¸€æ—¦æ³„éœ²ï¼Œåœ¨æœ‰æ•ˆæœŸå†…å¯èƒ½è¢«æ»¥ç”¨ã€‚åº”å¯¹ï¼š**ä½¿ç”¨HTTPS**ã€è®¾ç½®**åˆç†çš„è¾ƒçŸ­æœ‰æ•ˆæœŸ**ã€è€ƒè™‘åœ¨æœåŠ¡ç«¯ç»´æŠ¤ä¸€ä¸ªçŸ­å°çš„**ä»¤ç‰ŒåŠé”€åˆ—è¡¨ï¼ˆRBLï¼‰**ï¼ˆä½†ä¼šå¼•å…¥çŠ¶æ€ï¼‰ã€‚
    *   **ç®—æ³•æ··æ·†æ”»å‡»**ï¼šæ”»å‡»è€…å°è¯•å°†å¤´éƒ¨ä¸­çš„ç®—æ³•æ”¹ä¸º`none`ï¼ˆå¦‚æœæœåŠ¡å™¨é…ç½®ä¸å½“ï¼‰ã€‚åº”å¯¹ï¼šæœåŠ¡å™¨ç«¯åº”**ä¸¥æ ¼æ ¡éªŒç­¾åç®—æ³•**ï¼Œå¿½ç•¥å¤´éƒ¨çš„`alg`å­—æ®µæˆ–å¼ºåˆ¶ä½¿ç”¨é¢„æœŸç®—æ³•ã€‚
    *   **æ•æ„Ÿä¿¡æ¯æ³„éœ²**ï¼šPayloadä»…ç»è¿‡Base64ç¼–ç ï¼Œå¹¶éåŠ å¯†ã€‚åº”å¯¹ï¼š**é¿å…åœ¨JWTä¸­å­˜æ”¾æ•æ„Ÿä¿¡æ¯**ï¼ˆå¦‚å¯†ç ï¼‰ï¼Œå¿…è¦æ—¶è¿›è¡ŒåŠ å¯†ã€‚

#### åº”ç”¨åœºæ™¯
*   **å‰åç«¯åˆ†ç¦»åº”ç”¨**ï¼ˆå¦‚SPAã€ç§»åŠ¨Appï¼‰çš„APIè®¤è¯ã€‚
*   **æ— çŠ¶æ€åˆ†å¸ƒå¼å¾®æœåŠ¡**é—´çš„èº«ä»½ä¼ é€’å’Œå®‰å…¨è°ƒç”¨ã€‚
*   **ä¸€æ¬¡æ€§çš„ã€çŸ­æ—¶æœ‰æ•ˆçš„æ“ä½œæˆæƒ**ï¼ˆå¦‚å¯†ç é‡ç½®é“¾æ¥ï¼‰ã€‚

#### å¯æ‰©å±•æ€§
*   **æ— çŠ¶æ€**æ˜¯å…¶æœ€å¤§ä¼˜åŠ¿ï¼Œ**éå¸¸é€‚åˆæ°´å¹³æ‰©å±•**ã€‚ä»»ä½•æœåŠ¡å™¨å®ä¾‹åªè¦æŒæœ‰ç›¸åŒçš„å¯†é’¥å³å¯éªŒè¯ä»¤ç‰Œï¼Œæ— éœ€å…±äº«ä¼šè¯çŠ¶æ€ã€‚
*   æŒ‘æˆ˜åœ¨äº**ä»¤ç‰Œæ³¨é”€å’Œç»­ç­¾**æ¯”è¾ƒå›°éš¾ï¼Œé€šå¸¸é€šè¿‡è®¾ç½®è¾ƒçŸ­çš„æœ‰æ•ˆæœŸå¹¶ç»“åˆåˆ·æ–°ä»¤ç‰Œï¼ˆRefresh Tokenï¼‰æœºåˆ¶æ¥ç¼“è§£ã€‚

---

### ğŸ›¡ï¸ 2. OAuth 2.0 ä¸ OpenID Connect (OIDC)
OAuth 2.0æ˜¯ä¸€ä¸ª**æˆæƒæ¡†æ¶**ï¼Œå…è®¸ç”¨æˆ·æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®å…¶å­˜å‚¨åœ¨å¦ä¸€ä¸ªæœåŠ¡æä¾›è€…ä¸Šçš„èµ„æºï¼Œè€Œæ— éœ€åˆ†äº«å¯†ç ã€‚OpenID Connect (OIDC)æ˜¯å»ºç«‹åœ¨OAuth 2.0ä¹‹ä¸Šçš„ä¸€ä¸ª**èº«ä»½å±‚åè®®**ï¼Œç”¨äºèº«ä»½è®¤è¯ã€‚

#### åŸç†è¯¦è§£ (ä»¥æˆæƒç æ¨¡å¼ä¸ºä¾‹)
OAuth 2.0å®šä¹‰äº†å¤šç§æˆæƒæ¨¡å¼ä»¥é€‚åº”ä¸åŒåœºæ™¯ï¼Œä¾‹å¦‚æˆæƒç æ¨¡å¼ã€éšå¼æ¨¡å¼ã€å¯†ç æ¨¡å¼ç­‰ã€‚**æˆæƒç æ¨¡å¼**å› å…¶å®‰å…¨æ€§æœ€é«˜ï¼Œæ˜¯æœ€å¸¸ç”¨ä¸”æ¨èçš„æ¨¡å¼ï¼Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ· (User Agent)
    participant Client as å®¢æˆ·ç«¯åº”ç”¨
    participant AuthS as æˆæƒæœåŠ¡å™¨
    participant ResS as èµ„æºæœåŠ¡å™¨

    Note over User, Client: 1. ç”¨æˆ·è¯·æ±‚è®¿é—®å®¢æˆ·ç«¯
    User->>Client: è®¿é—®å®¢æˆ·ç«¯åº”ç”¨
    Client->>User: é‡å®šå‘è‡³æˆæƒæœåŠ¡å™¨

    Note over User, AuthS: 2. ç”¨æˆ·åœ¨æˆæƒæœåŠ¡å™¨è®¤è¯å¹¶æˆæƒ
    User->>AuthS: è®¤è¯èº«ä»½ï¼ŒåŒæ„æˆæƒ
    AuthS->>User: é‡å®šå‘å›å®¢æˆ·ç«¯å¹¶æºå¸¦æˆæƒç 

    Note over Client, AuthS: 3. å®¢æˆ·ç«¯ç”¨æˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œ
    Client->>AuthS: å‘é€æˆæƒç å’Œå®¢æˆ·ç«¯å‡­è¯
    AuthS->>Client: è¿”å›è®¿é—®ä»¤ç‰Œ (å’Œåˆ·æ–°ä»¤ç‰Œ)

    Note over Client, ResS: 4. å®¢æˆ·ç«¯ä½¿ç”¨è®¿é—®ä»¤ç‰Œè®¿é—®èµ„æº
    Client->>ResS: æºå¸¦è®¿é—®ä»¤ç‰Œè¯·æ±‚èµ„æº
    ResS->>Client: è¿”å›å—ä¿æŠ¤èµ„æº

    Note over Client, User: 5. å®¢æˆ·ç«¯å‘ˆç°èµ„æºç»™ç”¨æˆ·
    Client->>User: å‘ˆç°èµ„æº
```
*   **OpenID Connect (OIDC)** åœ¨OAuth 2.0æµç¨‹åŸºç¡€ä¸Šå¢åŠ äº†**ID Token**ã€‚ID Tokenæ˜¯ä¸€ä¸ªJWTï¼ŒåŒ…å«äº†å…³äºç”¨æˆ·èº«ä»½è®¤è¯çš„ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·IDã€ç­¾å‘è€…ã€æœ‰æ•ˆæœŸç­‰ï¼‰ã€‚å®¢æˆ·ç«¯ä¸ä»…è·å¾—è®¿é—®ä»¤ç‰Œï¼ˆç”¨äºè®¿é—®èµ„æºï¼‰ï¼Œè¿˜è·å¾—ID Tokenï¼ˆç”¨äºéªŒè¯ç”¨æˆ·èº«ä»½ï¼‰ï¼Œä»è€Œå®ç°äº†è®¤è¯ã€‚

#### å®‰å…¨æ€§
*   **ä¼˜ç‚¹**ï¼š**ä¸å¤„ç†ç”¨æˆ·å‡­è¯**ï¼šç¬¬ä¸‰æ–¹åº”ç”¨ä¸ç›´æ¥æ¥è§¦ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ã€‚**ç»†ç²’åº¦çš„æƒé™æ§åˆ¶**ï¼šé€šè¿‡`scope`æ§åˆ¶æˆæƒèŒƒå›´ã€‚**çŸ­æœŸè®¿é—®**ï¼šè®¿é—®ä»¤ç‰Œæœ‰æ•ˆæœŸè¾ƒçŸ­ã€‚
*   **é£é™©ä¸åº”å¯¹**ï¼š
    *   **æˆæƒç æ‹¦æˆª**ï¼šåº”å¯¹ï¼šä½¿ç”¨**PKCE**ï¼ˆProof Key for Code Exchangeï¼‰æ‰©å±•ï¼Œç‰¹åˆ«é€‚ç”¨äºåŸç”Ÿå’Œå…¬å…±å®¢æˆ·ç«¯ã€‚
    *   **è®¿é—®ä»¤ç‰Œæ³„éœ²**ï¼šåº”å¯¹ï¼š**çŸ­æœŸæœ‰æ•ˆ**ã€ä½¿ç”¨**HTTPS**ã€‚
    *   **é‡å®šå‘URIç¯¡æ”¹**ï¼šåº”å¯¹ï¼šåœ¨æˆæƒæœåŠ¡å™¨**å®Œæ•´æ³¨å†Œå¹¶éªŒè¯é‡å®šå‘URI**ã€‚
    *   **å®¢æˆ·ç«¯ä»¿å†’**ï¼šåº”å¯¹ï¼šå¦¥å–„ä¿ç®¡**å®¢æˆ·ç«¯å¯†é’¥**ï¼ˆConfidential Clientï¼‰ã€‚

#### åº”ç”¨åœºæ™¯
*   **ç¬¬ä¸‰æ–¹åº”ç”¨æˆæƒ**ï¼ˆå¦‚â€œä½¿ç”¨å¾®ä¿¡/Googleç™»å½•â€ï¼‰ã€‚
*   **å•ç‚¹ç™»å½•**ã€‚
*   **å¼€æ”¾APIå¹³å°**çš„æˆæƒç®¡ç†ï¼ˆå¦‚å¾®ä¿¡å¼€æ”¾å¹³å°ã€GitHub APIï¼‰ã€‚

#### å¯æ‰©å±•æ€§
*   éå¸¸é€‚åˆ**åˆ†å¸ƒå¼å’Œå¾®æœåŠ¡æ¶æ„**ã€‚èµ„æºæœåŠ¡å™¨å¯ä»¥ç‹¬ç«‹äºè®¤è¯æœåŠ¡å™¨è¿›è¡Œæ‰©å±•ï¼Œåªéœ€èƒ½å¤ŸéªŒè¯ä»¤ç‰Œï¼ˆä¾‹å¦‚é€šè¿‡JWTè‡ªåŒ…å«æ€§æˆ–ä»¤ç‰Œå†…çœç«¯ç‚¹ï¼‰ã€‚
*   OIDCæä¾›äº†**æ ‡å‡†çš„ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹**ï¼ˆ`/userinfo`ï¼‰ï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯è·å–ç”¨æˆ·ä¿¡æ¯ã€‚

---

### ğŸ¢ 3. SAML 2.0 (Security Assertion Markup Language)
SAMLæ˜¯ä¸€ä¸ªåŸºäºXMLçš„å¼€æ”¾æ ‡å‡†ï¼Œç”¨äºåœ¨**èº«ä»½æä¾›å•†ï¼ˆIdPï¼‰** å’Œ**æœåŠ¡æä¾›å•†ï¼ˆSPï¼‰** ä¹‹é—´äº¤æ¢è®¤è¯å’Œæˆæƒæ•°æ®ï¼Œä¸»è¦ç”¨äºå®ç°ä¼ä¸šçº§**å•ç‚¹ç™»å½•**ã€‚

#### åŸç†è¯¦è§£
```mermaid
flowchart LR
    A[ç”¨æˆ·] --> B[è®¿é—®æœåŠ¡æä¾›å•†<br>SP]
    B --> C[é‡å®šå‘è‡³èº«ä»½æä¾›å•†<br>IdP]
    C --> D[ç”¨æˆ·åœ¨IdPè®¤è¯]
    D --> E[IdPç”ŸæˆSAMLå“åº”<br>åŒ…å«æ–­è¨€]
    E --> F[POSTå“åº”å›SP]
    F --> G[SPéªŒè¯æ–­è¨€å¹¶åˆ›å»ºæœ¬åœ°ä¼šè¯]
    G --> H[ç”¨æˆ·è®¿é—®SPèµ„æº]
```
SAMLæ–­è¨€æ˜¯æ ¸å¿ƒï¼Œæœ‰ä¸‰ç§ç±»å‹ï¼šè®¤è¯æ–­è¨€ã€å±æ€§æ–­è¨€ã€æˆæƒå†³ç­–æ–­è¨€ã€‚SAMLæ¶ˆæ¯é€šå¸¸é€šè¿‡HTTP POSTç»‘å®šä¼ è¾“ï¼Œæ¶ˆæ¯å†…å®¹ä¼šè¢«ç­¾åä»¥ç¡®ä¿å®Œæ•´æ€§ã€‚

#### å®‰å…¨æ€§
*   **ä¼˜ç‚¹**ï¼š**å¼ºå®‰å…¨æ€§**ï¼šåŸºäºXMLæ•°å­—ç­¾åï¼Œæ–­è¨€é˜²ç¯¡æ”¹ã€‚**èº«ä»½ä¿¡æ¯ç”±IdPé›†ä¸­ç®¡ç†**ã€‚
*   **é£é™©ä¸åº”å¯¹**ï¼š
    *   **XMLç­¾ååŒ…è£…æ”»å‡»**ï¼šåº”å¯¹ï¼šSPéœ€ä»”ç»†éªŒè¯ç­¾åå¯¹åº”çš„XMLèŠ‚ç‚¹ã€‚
    *   **SAMLæ–­è¨€é‡æ”¾**ï¼šåº”å¯¹ï¼šIdPåº”åœ¨æ–­è¨€ä¸­åŒ…å«å”¯ä¸€IDå’Œæ—¶é—´æˆ³ï¼ŒSPå¯æ£€æŸ¥é‡å¤IDã€‚
    *   **è¯ä¹¦ç®¡ç†**ï¼šIdPå’ŒSPéœ€è¦äº¤æ¢å…¬é’¥/è¯ä¹¦ï¼Œç®¡ç†ä¸Šæœ‰ä¸€å®šå¼€é”€ã€‚

#### åº”ç”¨åœºæ™¯
*   **ä¼ä¸šçº§å•ç‚¹ç™»å½•**ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ä¸ä¼ ç»Ÿçš„ä¼ä¸šèº«ä»½ç³»ç»Ÿï¼ˆå¦‚Active Directoryï¼‰é›†æˆã€‚
*   **æ•™è‚²æœºæ„å’Œæ”¿åºœç³»ç»Ÿ**çš„è·¨å¹³å°èº«ä»½è®¤è¯ã€‚

#### å¯æ‰©å±•æ€§
*   åœ¨**ä¼ä¸šå†…éƒ¨æˆ–ä¿¡ä»»ä¼™ä¼´ä¹‹é—´**çš„è”é‚¦èº«ä»½åœºæ™¯ä¸­æ‰©å±•æ€§è‰¯å¥½ã€‚ä¸€ä¸ªIdPå¯ä»¥ä¸ºå¤šä¸ªSPæä¾›è®¤è¯æœåŠ¡ã€‚
*   åŸºäºXMLçš„æ¶ˆæ¯é€šå¸¸æ¯”è¾ƒ**å†—é•¿**ï¼Œå¯èƒ½å¯¹æ€§èƒ½å’Œç½‘ç»œå¸¦å®½æœ‰å½±å“ã€‚
*   **ä¸æ”¯æŒå¤©ç„¶çš„RESTful APIé›†æˆ**ï¼Œæ›´é€‚åˆWebæµè§ˆå™¨ç«¯çš„SSOã€‚

---

### ğŸ“Š æŠ€æœ¯å¯¹æ¯”ä¸é€‰å‹å»ºè®®

| ç‰¹æ€§         | JWT (æ— çŠ¶æ€)       | OAuth 2.0 / OIDC		 | SAML 2.0           |
| :----------- | :----------------- | :-------------------- | :----------------- |
| **åè®®ç±»å‹**   | ä»¤ç‰Œæ ¼å¼/æ ‡å‡†        | æˆæƒæ¡†æ¶ / èº«ä»½å±‚åè®®       | è®¤è¯/æˆæƒæ–­è¨€æ ‡å‡†      |
| **ä¸»è¦ç”¨é€”**   | æ— çŠ¶æ€APIè®¤è¯       | ç¬¬ä¸‰æ–¹æˆæƒã€è”é‚¦èº«ä»½ã€SSO   | ä¼ä¸šçº§SSO          |
| **ä»¤ç‰Œæ ¼å¼**   | JSON (ç´§å‡‘)        | JSON / JWT (OIDC)     | XML (å†—é•¿)         |
| **é€šä¿¡ç»‘å®š**   | HTTP Header        | HTTP é‡å®šå‘ã€POSTç­‰     | HTTP POSTã€é‡å®šå‘    |
| **æ€§èƒ½ç‰¹ç‚¹**   | è½»é‡ï¼Œç¼–ç è§£ç å¿«     | æµç¨‹æ­¥éª¤è¾ƒå¤š           | XMLè§£æå¼€é”€å¤§      |
| **æ— çŠ¶æ€æ€§**   | â­â­â­â­â­ (å¼º)      | â­â­â­â­ (å¯åšåˆ°æ— çŠ¶æ€)  | â­â­ (å¼±ï¼Œä¾èµ–IdPçŠ¶æ€) |
| **ç§»åŠ¨/APIå‹å¥½** | â­â­â­â­â­          | â­â­â­â­â­             | â­â­ (ä¸»è¦ä¸ºWebè®¾è®¡) |
| **ä¼ä¸šé›†æˆ**   | â­â­â­ (éœ€è‡ªè¡Œå®ç°) | â­â­â­â­ (æ ‡å‡†åè®®)     | â­â­â­â­â­ (æˆç†Ÿ)    |

#### é€‰å‹å»ºè®®

*   **æ„å»ºç°ä»£å‰åç«¯åˆ†ç¦»åº”ç”¨æˆ–å¾®æœåŠ¡API**ï¼šä¼˜å…ˆé€‰æ‹© **JWT** æˆ– **OAuth 2.0 å®¢æˆ·ç«¯å‡­è¯æ¨¡å¼/å¯†ç æ¨¡å¼**ã€‚è‹¥éœ€å®Œæ•´çš„èº«ä»½ä¿¡æ¯ï¼Œ**OIDC** æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚
*   **éœ€è¦å®ç°â€œä½¿ç”¨ç¬¬ä¸‰æ–¹ç¤¾äº¤è´¦å·ç™»å½•â€**ï¼šå¿…é¡»ä½¿ç”¨ **OAuth 2.0** å’Œ **OIDC**ã€‚
*   **æ„å»ºä¼ä¸šå†…ç½‘å•ç‚¹ç™»å½•æˆ–ä¸ADé›†æˆ**ï¼š**SAML 2.0** ä»ç„¶æ˜¯è®¸å¤šä¼ä¸šçš„æ ‡å‡†é€‰æ‹©ï¼Œä½† **OIDC** å› å…¶å¯¹ç°ä»£åº”ç”¨æ›´å‹å¥½è€Œæ—¥ç›Šæµè¡Œã€‚
*   **é«˜åº¦åˆ†å¸ƒå¼ã€éœ€è¦æè‡´æ‰©å±•æ€§çš„ç³»ç»Ÿ**ï¼š**æ— çŠ¶æ€çš„JWT** ä¼˜åŠ¿æ˜æ˜¾ï¼Œä½†éœ€å¦¥å–„å¤„ç†ä»¤ç‰ŒåŠé”€å’Œåˆ·æ–°é—®é¢˜ã€‚

---

### ğŸ’ æ€»ç»“

é€‰æ‹©å“ªç§è®¤è¯æŠ€æœ¯ï¼Œå–å†³äºä½ çš„å…·ä½“åº”ç”¨åœºæ™¯ã€å®‰å…¨è¦æ±‚ã€åŸºç¡€è®¾æ–½å’Œå›¢é˜ŸæŠ€æœ¯æ ˆã€‚

*   **JWT** ä»¥å…¶**ç®€å•ã€è‡ªåŒ…å«å’Œæ— çŠ¶æ€**çš„ç‰¹æ€§ï¼Œæˆä¸º**APIé©±åŠ¨ä¸–ç•Œå’Œå¾®æœåŠ¡æ¶æ„çš„å® å„¿**ã€‚
*   **OAuth 2.0 å’Œ OIDC** æä¾›äº†**æ›´ä¸°å¯Œã€æ›´å®‰å…¨ã€æ›´æ ‡å‡†åŒ–çš„æˆæƒå’Œè®¤è¯æµç¨‹**ï¼Œæ˜¯ç°ä»£åº”ç”¨é›†æˆç¬¬ä¸‰æ–¹èº«ä»½å’Œå®ç°è”é‚¦å•ç‚¹ç™»å½•çš„**äº‹å®æ ‡å‡†**ã€‚
*   **SAML 2.0** åˆ™åœ¨**ä¼ ç»Ÿä¼ä¸šçº§SSOé¢†åŸŸ**ä¾ç„¶å æ®é‡è¦åœ°ä½ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ä¸é—ç•™ç³»ç»Ÿé›†æˆçš„åœºæ™¯ã€‚

å¯¹äºæ‚¨ä¹‹å‰æåˆ°çš„SSMé¡¹ç›®å‡çº§ï¼Œå¦‚æœè½¬å‘åˆ†å¸ƒå¼æ¶æ„ï¼Œå¼•å…¥ **Spring Security + OAuth 2.0 Resource Server + JWT** æˆ–ç›´æ¥é‡‡ç”¨ **Spring Security OIDC** å®¢æˆ·ç«¯ä¼šæ˜¯ä¸€ä¸ªæ–¹å‘ã€‚å¯¹äºå…¨æ–°çš„å¾®æœåŠ¡é¡¹ç›®ï¼Œ**OIDC** é€šå¸¸æ˜¯æ›´æ¨èçš„åŸºç¡€è®¾æ–½çº§é€‰æ‹©ã€‚

å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£ç°ä»£è®¤è¯æŠ€æœ¯ã€‚å¦‚æœæ‚¨æœ‰æ›´å…·ä½“çš„åœºæ™¯æˆ–ç–‘é—®ï¼Œæˆ‘å¾ˆä¹æ„æä¾›è¿›ä¸€æ­¥çš„åˆ†æã€‚

# 3. ä»£ç æ¼”ç¤ºæ¡ˆä¾‹
```plain text
é‡‡ç”¨SSMæ¡†æ¶ã€Mavenç®¡ç†ï¼Œè¯·ä¸¾ä¾‹ä¸€ä¸ªå®Œæ•´çš„JWTç”¨æˆ·è®¤è¯æ¡ˆä¾‹ï¼ˆå‰ç«¯ï¼šç®€å•html+css+jsï¼‰ï¼Œå…ˆç»™å‡ºé¡¹ç›®ç›®å½•ã€è¯¦ç»†æ­¥éª¤ã€ä»£ç ã€æ€»ç»“
```

> æˆ‘ä»¬å°†åœ¨SSMæ¡†æ¶ä¸‹æ•´åˆJWTè®¤è¯ã€‚ç”±äºSSMæ¡†æ¶å·²ç»æ¯”è¾ƒä¼ ç»Ÿï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Mavenç®¡ç†ä¾èµ–ï¼Œå¹¶æ„å»ºä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç™»å½•å’ŒJWTè®¤è¯çš„ä¾‹å­ã€‚
> æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬å‡è®¾ä½ å·²ç»é…ç½®å¥½äº†SSMæ¡†æ¶çš„åŸºæœ¬ç¯å¢ƒï¼ˆå¦‚web.xml, springmvc.xml, spring.xmlç­‰ï¼‰ã€‚
>
> æ­¥éª¤ï¼š
>
> 1. æ·»åŠ JWTç›¸å…³ä¾èµ–
> 2. ç¼–å†™JWTå·¥å…·ç±»ï¼ˆç”ŸæˆTokenã€éªŒè¯Tokenç­‰ï¼‰
> 3. ä¿®æ”¹ç™»å½•é€»è¾‘ï¼ŒæˆåŠŸåˆ™è¿”å›JWT Token
> 4. ç¼–å†™ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ›¿ä»£åŸæ¥çš„Sessionæ‹¦æˆªå™¨ï¼ŒéªŒè¯JWT Token
> 5. å‰ç«¯é¡µé¢ä½¿ç”¨JavaScriptå­˜å‚¨Tokenï¼Œå¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶æºå¸¦
>
> æ³¨æ„ï¼šä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬å°†Tokenè¿”å›ç»™å‰ç«¯åï¼Œå‰ç«¯å°†å…¶å­˜å‚¨åœ¨localStorageä¸­ï¼Œå¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶æ”¾åœ¨Authorizationå¤´ä¸­ã€‚
>
> é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆä¸»è¦éƒ¨åˆ†ï¼‰ï¼š
> src/main/java
> |-- com.example.controller
> |-- UserController.java (ä¿®æ”¹ç™»å½•æ–¹æ³•ï¼Œè¿”å›Token)
> |-- com.example.interceptor
> |-- JwtInterceptor.java (JWTæ‹¦æˆªå™¨)
> |-- com.example.utils
> |-- JwtUtils.java (JWTå·¥å…·ç±»)
> src/main/webapp
> |-- login.html
> |-- index.html
> |-- static
> |-- css
> |-- js
> |-- login.js
> |-- index.js
>
> è¯¦ç»†æ­¥éª¤ï¼š
>
> 1. æ·»åŠ JWTä¾èµ–ï¼ˆpom.xmlï¼‰
>    æˆ‘ä»¬ä½¿ç”¨jjwtåº“æ¥å¤„ç†JWTã€‚
> 2. ç¼–å†™JWTå·¥å…·ç±»ï¼ˆJwtUtils.javaï¼‰
> 3. ä¿®æ”¹UserControllerçš„ç™»å½•æ–¹æ³•ï¼ŒæˆåŠŸæ—¶ç”ŸæˆTokenå¹¶è¿”å›ç»™å‰ç«¯ã€‚
> 4. ç¼–å†™JWTæ‹¦æˆªå™¨ï¼Œåœ¨preHandleæ–¹æ³•ä¸­éªŒè¯Tokenã€‚
> 5. é…ç½®æ‹¦æˆªå™¨ï¼ˆåœ¨springmvc.xmlä¸­é…ç½®æ‹¦æˆªè·¯å¾„ï¼‰
> 6. ç¼–å†™å‰ç«¯é¡µé¢ï¼Œä½¿ç”¨JavaScriptå¤„ç†ç™»å½•å’ŒTokençš„å­˜å‚¨ä¸æºå¸¦ã€‚
>
> ç”±äºç¯‡å¹…é™åˆ¶ï¼Œè¿™é‡Œåªç»™å‡ºå…³é”®ä»£ç ã€‚
>
> æ³¨æ„ï¼šå®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒJWTçš„å¯†é’¥åº”è¯¥å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”ä¸èƒ½æ³„éœ²ã€‚è¿™é‡Œä¸ºäº†ç¤ºä¾‹ï¼Œæˆ‘ä»¬ç›´æ¥å†™åœ¨ä»£ç ä¸­ã€‚

# ğŸ” SSMæ¡†æ¶æ•´åˆJWTè®¤è¯å®Œæ•´æ¡ˆä¾‹

ä¸‹é¢æˆ‘å°†ä¸ºæ‚¨æä¾›ä¸€ä¸ªå®Œæ•´çš„SSMæ¡†æ¶æ•´åˆJWTè®¤è¯çš„ç¤ºä¾‹ï¼ŒåŒ…æ‹¬é¡¹ç›®ç»“æ„ã€è¯¦ç»†æ­¥éª¤å’Œä»£ç å®ç°ã€‚

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
ssm-jwt-demo/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main/
â”‚       â”œâ”€â”€ java/
â”‚       â”‚   â””â”€â”€ com/
â”‚       â”‚       â””â”€â”€ example/
â”‚       â”‚           â”œâ”€â”€ controller/
â”‚       â”‚           â”‚   â”œâ”€â”€ UserController.java
â”‚       â”‚           â”‚   â””â”€â”€ ApiController.java
â”‚       â”‚           â”œâ”€â”€ interceptor/
â”‚       â”‚           â”‚   â””â”€â”€ JwtInterceptor.java
â”‚       â”‚           â”œâ”€â”€ utils/
â”‚       â”‚           â”‚   â””â”€â”€ JwtUtils.java
â”‚       â”‚           â”œâ”€â”€ entity/
â”‚       â”‚           â”‚   â””â”€â”€ User.java
â”‚       â”‚           â”œâ”€â”€ service/
â”‚       â”‚           â”‚   â”œâ”€â”€ UserService.java
â”‚       â”‚           â”‚   â””â”€â”€ impl/
â”‚       â”‚           â”‚       â””â”€â”€ UserServiceImpl.java
â”‚       â”‚           â””â”€â”€ config/
â”‚       â”‚               â””â”€â”€ WebConfig.java
â”‚       â”œâ”€â”€ resources/
â”‚       â”‚   â”œâ”€â”€ spring/
â”‚       â”‚   â”‚   â”œâ”€â”€ applicationContext.xml
â”‚       â”‚   â”‚   â”œâ”€â”€ spring-mvc.xml
â”‚       â”‚   â”‚   â””â”€â”€ mybatis-config.xml
â”‚       â”‚   â”œâ”€â”€ mapper/
â”‚       â”‚   â”‚   â””â”€â”€ UserMapper.xml
â”‚       â”‚   â””â”€â”€ jdbc.properties
â”‚       â””â”€â”€ webapp/
â”‚           â”œâ”€â”€ WEB-INF/
â”‚           â”‚   â””â”€â”€ web.xml
â”‚           â”œâ”€â”€ static/
â”‚           â”‚   â”œâ”€â”€ css/
â”‚           â”‚   â”‚   â””â”€â”€ style.css
â”‚           â”‚   â”œâ”€â”€ js/
â”‚           â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚           â”‚   â”‚   â””â”€â”€ api.js
â”‚           â”‚   â””â”€â”€ lib/
â”‚           â”‚       â””â”€â”€ axios.min.js
â”‚           â””â”€â”€ index.html
â”œâ”€â”€ pom.xml
â””â”€â”€ README.md
```

## ğŸ“‹ å®æ–½æ­¥éª¤

### 1. æ·»åŠ Mavenä¾èµ–

åœ¨`pom.xml`ä¸­æ·»åŠ JWTç›¸å…³ä¾èµ–ï¼š

```xml
<dependencies>
    <!-- SSMæ¡†æ¶ç›¸å…³ä¾èµ–... -->
    
    <!-- JWTä¾èµ– -->
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-api</artifactId>
        <version>0.11.5</version>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-impl</artifactId>
        <version>0.11.5</version>
        <scope>runtime</scope>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-jackson</artifactId>
        <version>0.11.5</version>
        <scope>runtime</scope>
    </dependency>
    
    <!-- Jackson for JSONå¤„ç† -->
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-databind</artifactId>
        <version>2.14.2</version>
    </dependency>
</dependencies>
```

### 2. åˆ›å»ºJWTå·¥å…·ç±»

`JwtUtils.java` - è´Ÿè´£JWTçš„ç”Ÿæˆå’ŒéªŒè¯ï¼š

```java
package com.example.utils;

import io.jsonwebtoken.*;
import io.jsonwebtoken.security.Keys;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import javax.crypto.SecretKey;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

@Component
public class JwtUtils {
    
    @Value("${jwt.secret}")
    private String secret;
    
    @Value("${jwt.expiration}")
    private Long expiration;
    
    // ç”Ÿæˆå¯†é’¥
    private SecretKey getSigningKey() {
        return Keys.hmacShaKeyFor(secret.getBytes());
    }
    
    // ç”ŸæˆJWTä»¤ç‰Œ
    public String generateToken(String username, Long userId) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("userId", userId);
        claims.put("username", username);
        
        return Jwts.builder()
                .setClaims(claims)
                .setSubject(username)
                .setIssuedAt(new Date())
                .setExpiration(new Date(System.currentTimeMillis() + expiration * 1000))
                .signWith(getSigningKey(), SignatureAlgorithm.HS256)
                .compact();
    }
    
    // ä»ä»¤ç‰Œä¸­è·å–ç”¨æˆ·å
    public String getUsernameFromToken(String token) {
        return getAllClaimsFromToken(token).getSubject();
    }
    
    // ä»ä»¤ç‰Œä¸­è·å–ç”¨æˆ·ID
    public Long getUserIdFromToken(String token) {
        return getAllClaimsFromToken(token).get("userId", Long.class);
    }
    
    // è·å–ä»¤ç‰Œçš„è¿‡æœŸæ—¶é—´
    public Date getExpirationDateFromToken(String token) {
        return getAllClaimsFromToken(token).getExpiration();
    }
    
    // éªŒè¯ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆ
    public boolean validateToken(String token, String username) {
        final String tokenUsername = getUsernameFromToken(token);
        return (tokenUsername.equals(username) && !isTokenExpired(token));
    }
    
    // æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦è¿‡æœŸ
    private boolean isTokenExpired(String token) {
        final Date expiration = getExpirationDateFromToken(token);
        return expiration.before(new Date());
    }
    
    // ä»ä»¤ç‰Œä¸­è·å–æ‰€æœ‰å£°æ˜
    private Claims getAllClaimsFromToken(String token) {
        return Jwts.parserBuilder()
                .setSigningKey(getSigningKey())
                .build()
                .parseClaimsJws(token)
                .getBody();
    }
}
```

### 3. åˆ›å»ºJWTæ‹¦æˆªå™¨

`JwtInterceptor.java` - æ›¿ä»£åŸæœ‰çš„Sessionæ‹¦æˆªå™¨ï¼š

```java
package com.example.interceptor;

import com.example.utils.JwtUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.servlet.HandlerInterceptor;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class JwtInterceptor implements HandlerInterceptor {
    
    @Autowired
    private JwtUtils jwtUtils;
    
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        // ä»è¯·æ±‚å¤´ä¸­è·å–token
        final String requestToken = request.getHeader("Authorization");
        
        // æ£€æŸ¥tokenæ˜¯å¦å­˜åœ¨
        if (requestToken == null || !requestToken.startsWith("Bearer ")) {
            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
            response.getWriter().write("{\"error\": \"æœªæä¾›æœ‰æ•ˆçš„è®¤è¯ä»¤ç‰Œ\"}");
            return false;
        }
        
        // æå–token
        final String token = requestToken.substring(7);
        
        try {
            // éªŒè¯token
            if (jwtUtils.isTokenExpired(token)) {
                response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
                response.getWriter().write("{\"error\": \"ä»¤ç‰Œå·²è¿‡æœŸ\"}");
                return false;
            }
            
            // å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥è¯·æ±‚å±æ€§ï¼Œä¾›æ§åˆ¶å™¨ä½¿ç”¨
            String username = jwtUtils.getUsernameFromToken(token);
            Long userId = jwtUtils.getUserIdFromToken(token);
            
            request.setAttribute("username", username);
            request.setAttribute("userId", userId);
            
            return true;
        } catch (Exception e) {
            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
            response.getWriter().write("{\"error\": \"æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ\"}");
            return false;
        }
    }
}
```

### 4. é…ç½®æ‹¦æˆªå™¨

`WebConfig.java` - é…ç½®JWTæ‹¦æˆªå™¨ï¼š

```java
package com.example.config;

import com.example.interceptor.JwtInterceptor;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Autowired
    private JwtInterceptor jwtInterceptor;
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(jwtInterceptor)
                .addPathPatterns("/api/**") // æ‹¦æˆªAPIè·¯å¾„
                .excludePathPatterns("/api/login", "/api/register"); // æ’é™¤ç™»å½•å’Œæ³¨å†Œ
    }
}
```

### 5. ä¿®æ”¹ç”¨æˆ·æ§åˆ¶å™¨

`UserController.java` - å®ç°åŸºäºJWTçš„ç™»å½•ï¼š

```java
package com.example.controller;

import com.example.entity.User;
import com.example.service.UserService;
import com.example.utils.JwtUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.Map;

@RestController
@RequestMapping("/api")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private JwtUtils jwtUtils;
    
    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody Map<String, String> credentials) {
        String username = credentials.get("username");
        String password = credentials.get("password");
        
        // éªŒè¯ç”¨æˆ·
        User user = userService.authenticate(username, password);
        if (user == null) {
            return ResponseEntity.status(401).body("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }
        
        // ç”ŸæˆJWTä»¤ç‰Œ
        String token = jwtUtils.generateToken(user.getUsername(), user.getId());
        
        // è¿”å›ä»¤ç‰Œå’Œç”¨æˆ·ä¿¡æ¯
        Map<String, Object> response = new HashMap<>();
        response.put("token", token);
        response.put("user", user);
        
        return ResponseEntity.ok(response);
    }
    
    @GetMapping("/profile")
    public ResponseEntity<?> getProfile(@RequestAttribute Long userId) {
        // ä»æ‹¦æˆªå™¨ä¸­è®¾ç½®çš„å±æ€§è·å–ç”¨æˆ·ID
        User user = userService.getUserById(userId);
        return ResponseEntity.ok(user);
    }
    
    // å…¶ä»–APIç«¯ç‚¹...
}
```

### 6. é…ç½®æ–‡ä»¶

åœ¨`resources/application.properties`ä¸­æ·»åŠ JWTé…ç½®ï¼š

```properties
# JWTé…ç½®
jwt.secret=mySuperSecretKeyThatIsAtLeast256BitsLongForHS256Algorithm
jwt.expiration=86400  # 24å°æ—¶
```

### 7. å‰ç«¯å®ç°

`index.html` - ä¸»é¡µé¢ï¼š

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>JWTè®¤è¯ç¤ºä¾‹</title>
    <link rel="stylesheet" href="static/css/style.css">
</head>
<body>
    <div class="container">
        <h1>JWTè®¤è¯ç¤ºä¾‹</h1>
        
        <div id="login-form" class="form-container">
            <h2>ç”¨æˆ·ç™»å½•</h2>
            <form onsubmit="return login(event)">
                <div class="form-group">
                    <label for="username">ç”¨æˆ·å:</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">å¯†ç :</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit">ç™»å½•</button>
            </form>
        </div>
        
        <div id="user-info" class="hidden">
            <h2>ç”¨æˆ·ä¿¡æ¯</h2>
            <p>æ¬¢è¿, <span id="user-name"></span>!</p>
            <button onclick="getProfile()">è·å–ä¸ªäººä¿¡æ¯</button>
            <button onclick="logout()">é€€å‡ºç™»å½•</button>
            <div id="profile-data"></div>
        </div>
    </div>

    <script src="static/lib/axios.min.js"></script>
    <script src="static/js/auth.js"></script>
    <script src="static/js/api.js"></script>
</body>
</html>
```

`static/css/style.css` - æ ·å¼æ–‡ä»¶ï¼š

```css
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f5f5f5;
}

.container {
    max-width: 600px;
    margin: 0 auto;
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.form-container {
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 15px;
}

label {
    display: block;
    margin-bottom: 5px;
}

input[type="text"],
input[type="password"] {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}

button {
    background-color: #4CAF50;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background-color: #45a049;
}

.hidden {
    display: none;
}

#profile-data {
    margin-top: 20px;
    padding: 10px;
    background-color: #f9f9f9;
    border-radius: 4px;
}
```

`static/js/auth.js` - è®¤è¯ç›¸å…³åŠŸèƒ½ï¼š

```javascript
// ä¿å­˜tokenåˆ°localStorage
function saveToken(token) {
    localStorage.setItem('jwt_token', token);
}

// ä»localStorageè·å–token
function getToken() {
    return localStorage.getItem('jwt_token');
}

// ç§»é™¤token
function removeToken() {
    localStorage.removeItem('jwt_token');
}

// æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
function isLoggedIn() {
    return getToken() !== null;
}

// ç™»å½•å‡½æ•°
function login(event) {
    event.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    axios.post('/api/login', {
        username: username,
        password: password
    })
    .then(response => {
        const token = response.data.token;
        saveToken(token);
        
        // æ›´æ–°UI
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('user-info').classList.remove('hidden');
        document.getElementById('user-name').textContent = response.data.user.username;
        
        // è®¾ç½®Axiosé»˜è®¤æˆæƒå¤´
        axios.defaults.headers.common['Authorization'] = 'Bearer ' + token;
    })
    .catch(error => {
        alert('ç™»å½•å¤±è´¥: ' + (error.response?.data || error.message));
    });
}

// é€€å‡ºç™»å½•
function logout() {
    removeToken();
    delete axios.defaults.headers.common['Authorization'];
    
    // æ›´æ–°UI
    document.getElementById('login-form').classList.remove('hidden');
    document.getElementById('user-info').classList.add('hidden');
    document.getElementById('profile-data').innerHTML = '';
}

// é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
document.addEventListener('DOMContentLoaded', function() {
    const token = getToken();
    if (token) {
        // è®¾ç½®Axiosé»˜è®¤æˆæƒå¤´
        axios.defaults.headers.common['Authorization'] = 'Bearer ' + token;
        
        // æ›´æ–°UI
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('user-info').classList.remove('hidden');
        
        // è·å–ç”¨æˆ·åæ˜¾ç¤º
        // æ³¨æ„: å®é™…åº”ç”¨ä¸­åº”ä»tokenè§£ææˆ–è°ƒç”¨APIè·å–
        document.getElementById('user-name').textContent = 'ç”¨æˆ·';
    }
});
```

`static/js/api.js` - APIè°ƒç”¨ç¤ºä¾‹ï¼š

```javascript
// è·å–ç”¨æˆ·ä¸ªäººä¿¡æ¯
function getProfile() {
    axios.get('/api/profile')
    .then(response => {
        const user = response.data;
        document.getElementById('profile-data').innerHTML = `
            <h3>ä¸ªäººä¿¡æ¯</h3>
            <p>ID: ${user.id}</p>
            <p>ç”¨æˆ·å: ${user.username}</p>
            <p>é‚®ç®±: ${user.email || 'æœªè®¾ç½®'}</p>
        `;
    })
    .catch(error => {
        if (error.response?.status === 401) {
            alert('è®¤è¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
            logout();
        } else {
            alert('è·å–ä¿¡æ¯å¤±è´¥: ' + (error.response?.data || error.message));
        }
    });
}
```

## ğŸ”§ é…ç½®è¯´æ˜

### Spring MVCé…ç½®

åœ¨`spring-mvc.xml`ä¸­æ·»åŠ ï¼š

```xml
<!-- å¯ç”¨æ³¨è§£é©±åŠ¨ -->
<mvc:annotation-driven>
    <mvc:message-converters>
        <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter">
            <property name="objectMapper">
                <bean class="com.fasterxml.jackson.databind.ObjectMapper">
                    <property name="dateFormat">
                        <bean class="java.text.SimpleDateFormat">
                            <constructor-arg type="java.lang.String" value="yyyy-MM-dd HH:mm:ss" />
                        </bean>
                    </property>
                </bean>
            </property>
        </bean>
    </mvc:message-converters>
</mvc:annotation-driven>

<!-- é™æ€èµ„æºå¤„ç† -->
<mvc:resources mapping="/static/**" location="/static/" />

<!-- æ‹¦æˆªå™¨é…ç½® -->
<mvc:interceptors>
    <mvc:interceptor>
        <mvc:mapping path="/api/**"/>
        <mvc:exclude-mapping path="/api/login"/>
        <mvc:exclude-mapping path="/api/register"/>
        <bean class="com.example.interceptor.JwtInterceptor"/>
    </mvc:interceptor>
</mvc:interceptors>
```

### Web.xmlé…ç½®

ç¡®ä¿web.xmlä¸­é…ç½®äº†Spring MVCçš„DispatcherServletï¼š

```xml
<servlet>
    <servlet-name>springmvc</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
    <init-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>classpath:spring/spring-mvc.xml</param-value>
    </init-param>
    <load-on-startup>1</load-on-startup>
</servlet>

<servlet-mapping>
    <servlet-name>springmvc</servlet-name>
    <url-pattern>/</url-pattern>
</servlet-mapping>
```

## ğŸ’¡ æ€»ç»“ä¸æ³¨æ„äº‹é¡¹

### âœ… ä¼˜åŠ¿

1. **æ— çŠ¶æ€è®¤è¯**ï¼šæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ä¼šè¯ä¿¡æ¯ï¼Œé€‚åˆåˆ†å¸ƒå¼å’Œå¾®æœåŠ¡æ¶æ„
2. **è·¨åŸŸæ”¯æŒ**ï¼šJWTå¯ä»¥è½»æ¾å®ç°è·¨åŸŸè®¤è¯
3. **å®‰å…¨æ€§**ï¼šä½¿ç”¨æ•°å­—ç­¾åé˜²æ­¢ç¯¡æ”¹ï¼Œæ¯”Sessionæ›´å®‰å…¨
4. **æ‰©å±•æ€§**ï¼šå¯ä»¥åœ¨ä»¤ç‰Œä¸­åŒ…å«ç”¨æˆ·è§’è‰²å’Œæƒé™ä¿¡æ¯

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¯†é’¥å®‰å…¨**ï¼šJWTå¯†é’¥å¿…é¡»è¶³å¤Ÿå¤æ‚ä¸”å¦¥å–„ä¿ç®¡
2. **ä»¤ç‰Œè¿‡æœŸ**ï¼šè®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œä½¿ç”¨åˆ·æ–°ä»¤ç‰Œæœºåˆ¶å»¶é•¿ä¼šè¯
3. **æ•æ„Ÿä¿¡æ¯**ï¼šä¸è¦åœ¨JWTä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ŒPayloadåªæ˜¯Base64ç¼–ç è€ŒéåŠ å¯†
4. **ä»¤ç‰Œæ’¤é”€**ï¼šå®ç°ä»¤ç‰Œé»‘åå•æœºåˆ¶ä»¥å¤„ç†ç™»å‡ºå’Œå®‰å…¨æ€§é—®é¢˜
5. **HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPSä¼ è¾“ä»¤ç‰Œï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»

### ğŸ”„ æ‰©å±•å»ºè®®

1. å®ç°åˆ·æ–°ä»¤ç‰Œæœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨è®¿é—®ä»¤ç‰Œè¿‡æœŸåè·å–æ–°ä»¤ç‰Œ
2. æ·»åŠ å¤šå› ç´ è®¤è¯æ”¯æŒï¼Œæé«˜å®‰å…¨æ€§
3. é›†æˆSpring Securityæ¡†æ¶ï¼Œæä¾›æ›´å…¨é¢çš„å®‰å…¨è§£å†³æ–¹æ¡ˆ
4. å®ç°ä»¤ç‰Œé»‘åå•ï¼Œæ”¯æŒç”¨æˆ·ä¸»åŠ¨ç™»å‡ºå’Œä»¤ç‰Œæ’¤é”€

è¿™ä¸ªå®Œæ•´çš„JWTè®¤è¯ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨SSMæ¡†æ¶ä¸­å®ç°ç°ä»£åŒ–çš„æ— çŠ¶æ€è®¤è¯ï¼Œæ›¿ä»£ä¼ ç»Ÿçš„Session-basedè®¤è¯ï¼Œæ›´é€‚åˆå½“å‰å‰åç«¯åˆ†ç¦»å’Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„éœ€æ±‚ã€‚

# ğŸ”§ è¡¥å……å®ç°SSMæ¡†æ¶JWTè®¤è¯çš„å®Œæ•´ä»£ç 

ä¸‹é¢æˆ‘å°†è¡¥å……ä¹‹å‰æœªå®Œæˆçš„ä»£ç éƒ¨åˆ†ï¼ŒåŒ…æ‹¬Userå®ä½“ç±»ã€UserServiceæ¥å£åŠå®ç°ã€UserMapperæ¥å£åŠXMLæ˜ å°„æ–‡ä»¶ã€‚

## ğŸ“‹ å®ä½“ç±»å®ç°

### User.java - ç”¨æˆ·å®ä½“ç±»

```java
package com.example.entity;

import java.util.Date;

public class User {
    private Long id;
    private String username;
    private String password;
    private String email;
    private String phone;
    private Integer status; // 0:ç¦ç”¨, 1:æ­£å¸¸
    private Date createTime;
    private Date updateTime;
    
    // æ„é€ æ–¹æ³•
    public User() {}
    
    public User(String username, String password, String email) {
        this.username = username;
        this.password = password;
        this.email = email;
        this.status = 1;
        this.createTime = new Date();
        this.updateTime = new Date();
    }
    
    // Getterå’ŒSetteræ–¹æ³•
    public Long getId() {
        return id;
    }
    
    public void setId(Long id) {
        this.id = id;
    }
    
    public String getUsername() {
        return username;
    }
    
    public void setUsername(String username) {
        this.username = username;
    }
    
    public String getPassword() {
        return password;
    }
    
    public void setPassword(String password) {
        this.password = password;
    }
    
    public String getEmail() {
        return email;
    }
    
    public void setEmail(String email) {
        this.email = email;
    }
    
    public String getPhone() {
        return phone;
    }
    
    public void setPhone(String phone) {
        this.phone = phone;
    }
    
    public Integer getStatus() {
        return status;
    }
    
    public void setStatus(Integer status) {
        this.status = status;
    }
    
    public Date getCreateTime() {
        return createTime;
    }
    
    public void setCreateTime(Date createTime) {
        this.createTime = createTime;
    }
    
    public Date getUpdateTime() {
        return updateTime;
    }
    
    public void setUpdateTime(Date updateTime) {
        this.updateTime = updateTime;
    }
    
    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", username='" + username + '\'' +
                ", email='" + email + '\'' +
                ", status=" + status +
                ", createTime=" + createTime +
                '}';
    }
}
```

## ğŸ“‹ æ•°æ®è®¿é—®å±‚å®ç°

### UserMapper.java - ç”¨æˆ·æ•°æ®è®¿é—®æ¥å£

```java
package com.example.mapper;

import com.example.entity.User;
import org.apache.ibatis.annotations.Param;
import org.springframework.stereotype.Repository;

@Repository
public interface UserMapper {
    /**
     * æ ¹æ®ç”¨æˆ·åå’Œå¯†ç æŸ¥è¯¢ç”¨æˆ·
     */
    User findByUsernameAndPassword(@Param("username") String username, @Param("password") String password);
    
    /**
     * æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·
     */
    User findByUsername(@Param("username") String username);
    
    /**
     * æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ·
     */
    User findById(@Param("id") Long id);
    
    /**
     * æ’å…¥æ–°ç”¨æˆ·
     */
    int insert(User user);
    
    /**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
     */
    int update(User user);
    
    /**
     * åˆ é™¤ç”¨æˆ·
     */
    int delete(@Param("id") Long id);
}
```

### UserMapper.xml - MyBatisæ˜ å°„æ–‡ä»¶

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.UserMapper">
    
    <resultMap id="UserResultMap" type="com.example.entity.User">
        <id property="id" column="id" />
        <result property="username" column="username" />
        <result property="password" column="password" />
        <result property="email" column="email" />
        <result property="phone" column="phone" />
        <result property="status" column="status" />
        <result property="createTime" column="create_time" />
        <result property="updateTime" column="update_time" />
    </resultMap>
    
    <sql id="Base_Column_List">
        id, username, password, email, phone, status, create_time, update_time
    </sql>
    
    <select id="findByUsernameAndPassword" resultMap="UserResultMap">
        SELECT 
        <include refid="Base_Column_List" />
        FROM t_user
        WHERE username = #{username} AND password = #{password} AND status = 1
    </select>
    
    <select id="findByUsername" resultMap="UserResultMap">
        SELECT 
        <include refid="Base_Column_List" />
        FROM t_user
        WHERE username = #{username} AND status = 1
    </select>
    
    <select id="findById" resultMap="UserResultMap">
        SELECT 
        <include refid="Base_Column_List" />
        FROM t_user
        WHERE id = #{id} AND status = 1
    </select>
    
    <insert id="insert" parameterType="com.example.entity.User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_user (
            username, password, email, phone, status, create_time, update_time
        ) VALUES (
            #{username}, #{password}, #{email}, #{phone}, #{status}, #{createTime}, #{updateTime}
        )
    </insert>
    
    <update id="update" parameterType="com.example.entity.User">
        UPDATE t_user
        <set>
            <if test="username != null">username = #{username},</if>
            <if test="password != null">password = #{password},</if>
            <if test="email != null">email = #{email},</if>
            <if test="phone != null">phone = #{phone},</if>
            <if test="status != null">status = #{status},</if>
            update_time = NOW()
        </set>
        WHERE id = #{id}
    </update>
    
    <update id="delete">
        UPDATE t_user
        SET status = 0, update_time = NOW()
        WHERE id = #{id}
    </update>
</mapper>
```

## ğŸ“‹ æœåŠ¡å±‚å®ç°

### UserService.java - ç”¨æˆ·æœåŠ¡æ¥å£

```java
package com.example.service;

import com.example.entity.User;

public interface UserService {
    /**
     * ç”¨æˆ·è®¤è¯
     */
    User authenticate(String username, String password);
    
    /**
     * æ ¹æ®IDè·å–ç”¨æˆ·
     */
    User getUserById(Long id);
    
    /**
     * æ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·
     */
    User getUserByUsername(String username);
    
    /**
     * æ³¨å†Œæ–°ç”¨æˆ·
     */
    boolean register(User user);
    
    /**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
     */
    boolean updateUser(User user);
    
    /**
     * åˆ é™¤ç”¨æˆ·ï¼ˆé€»è¾‘åˆ é™¤ï¼‰
     */
    boolean deleteUser(Long id);
}
```

### UserServiceImpl.java - ç”¨æˆ·æœåŠ¡å®ç°

```java
package com.example.service.impl;

import com.example.entity.User;
import com.example.mapper.UserMapper;
import com.example.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.DigestUtils;

import java.util.Date;

@Service
@Transactional
public class UserServiceImpl implements UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    @Override
    public User authenticate(String username, String password) {
        // å¯¹å¯†ç è¿›è¡ŒMD5åŠ å¯†ï¼ˆå®é™…é¡¹ç›®ä¸­åº”ä½¿ç”¨æ›´å®‰å…¨çš„åŠ å¯†æ–¹å¼ï¼Œå¦‚BCryptï¼‰
        String encryptedPassword = DigestUtils.md5DigestAsHex(password.getBytes());
        return userMapper.findByUsernameAndPassword(username, encryptedPassword);
    }
    
    @Override
    public User getUserById(Long id) {
        return userMapper.findById(id);
    }
    
    @Override
    public User getUserByUsername(String username) {
        return userMapper.findByUsername(username);
    }
    
    @Override
    public boolean register(User user) {
        // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
        User existingUser = userMapper.findByUsername(user.getUsername());
        if (existingUser != null) {
            return false;
        }
        
        // å¯¹å¯†ç è¿›è¡ŒåŠ å¯†
        String encryptedPassword = DigestUtils.md5DigestAsHex(user.getPassword().getBytes());
        user.setPassword(encryptedPassword);
        
        // è®¾ç½®é»˜è®¤çŠ¶æ€å’Œåˆ›å»ºæ—¶é—´
        user.setStatus(1);
        user.setCreateTime(new Date());
        user.setUpdateTime(new Date());
        
        return userMapper.insert(user) > 0;
    }
    
    @Override
    public boolean updateUser(User user) {
        // å¦‚æœå¯†ç ä¸ä¸ºç©ºï¼Œåˆ™åŠ å¯†å¯†ç 
        if (user.getPassword() != null && !user.getPassword().isEmpty()) {
            String encryptedPassword = DigestUtils.md5DigestAsHex(user.getPassword().getBytes());
            user.setPassword(encryptedPassword);
        }
        
        user.setUpdateTime(new Date());
        return userMapper.update(user) > 0;
    }
    
    @Override
    public boolean deleteUser(Long id) {
        return userMapper.delete(id) > 0;
    }
}
```

## ğŸ“‹ æ§åˆ¶å™¨è¡¥å……å®ç°

### ApiController.java - æä¾›æ›´å¤šAPIç«¯ç‚¹

```java
package com.example.controller;

import com.example.entity.User;
import com.example.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.Map;

@RestController
@RequestMapping("/api")
public class ApiController {
    
    @Autowired
    private UserService userService;
    
    /**
     * ç”¨æˆ·æ³¨å†Œæ¥å£
     */
    @PostMapping("/register")
    public ResponseEntity<?> register(@RequestBody User user) {
        // åŸºæœ¬éªŒè¯
        if (user.getUsername() == null || user.getUsername().trim().isEmpty()) {
            return ResponseEntity.badRequest().body("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
        }
        
        if (user.getPassword() == null || user.getPassword().length() < 6) {
            return ResponseEntity.badRequest().body("å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½");
        }
        
        // å°è¯•æ³¨å†Œ
        boolean success = userService.register(user);
        if (success) {
            return ResponseEntity.ok("æ³¨å†ŒæˆåŠŸ");
        } else {
            return ResponseEntity.badRequest().body("ç”¨æˆ·åå·²å­˜åœ¨");
        }
    }
    
    /**
     * è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
     */
    @GetMapping("/userinfo")
    public ResponseEntity<?> getUserInfo(@RequestAttribute Long userId) {
        User user = userService.getUserById(userId);
        if (user != null) {
            // ä¸è¿”å›å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯
            Map<String, Object> userInfo = new HashMap<>();
            userInfo.put("id", user.getId());
            userInfo.put("username", user.getUsername());
            userInfo.put("email", user.getEmail());
            userInfo.put("phone", user.getPhone());
            userInfo.put("createTime", user.getCreateTime());
            
            return ResponseEntity.ok(userInfo);
        } else {
            return ResponseEntity.status(404).body("ç”¨æˆ·ä¸å­˜åœ¨");
        }
    }
    
    /**
     * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
     */
    @PutMapping("/userinfo")
    public ResponseEntity<?> updateUserInfo(
            @RequestAttribute Long userId,
            @RequestBody Map<String, String> updates) {
        
        User user = userService.getUserById(userId);
        if (user == null) {
            return ResponseEntity.status(404).body("ç”¨æˆ·ä¸å­˜åœ¨");
        }
        
        // æ›´æ–°å…è®¸ä¿®æ”¹çš„å­—æ®µ
        if (updates.containsKey("email")) {
            user.setEmail(updates.get("email"));
        }
        
        if (updates.containsKey("phone")) {
            user.setPhone(updates.get("phone"));
        }
        
        boolean success = userService.updateUser(user);
        if (success) {
            return ResponseEntity.ok("æ›´æ–°æˆåŠŸ");
        } else {
            return ResponseEntity.status(500).body("æ›´æ–°å¤±è´¥");
        }
    }
    
    /**
     * å¥åº·æ£€æŸ¥æ¥å£ï¼ˆæ— éœ€è®¤è¯ï¼‰
     */
    @GetMapping("/health")
    public ResponseEntity<?> healthCheck() {
        Map<String, String> response = new HashMap<>();
        response.put("status", "OK");
        response.put("timestamp", String.valueOf(System.currentTimeMillis()));
        return ResponseEntity.ok(response);
    }
}
```

## ğŸ“‹ æ•°æ®åº“è¡¨ç»“æ„

åˆ›å»ºç”¨æˆ·è¡¨çš„SQLè¯­å¥ï¼š

```sql
CREATE TABLE t_user (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ç”¨æˆ·ID',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å',
    password VARCHAR(100) NOT NULL COMMENT 'å¯†ç ',
    email VARCHAR(100) COMMENT 'é‚®ç®±',
    phone VARCHAR(20) COMMENT 'æ‰‹æœºå·',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€: 0-ç¦ç”¨, 1-æ­£å¸¸',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    INDEX idx_username (username),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

## ğŸ“‹ Springé…ç½®æ–‡ä»¶è¡¥å……

### applicationContext.xml - æ·»åŠ æœåŠ¡å±‚æ‰«æå’Œäº‹åŠ¡ç®¡ç†

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd">
    
    <!-- æ‰«æServiceç»„ä»¶ -->
    <context:component-scan base-package="com.example.service" />
    
    <!-- å¼€å¯æ³¨è§£é©±åŠ¨çš„äº‹åŠ¡ç®¡ç† -->
    <tx:annotation-driven transaction-manager="transactionManager" />
    
    <!-- äº‹åŠ¡ç®¡ç†å™¨ -->
    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource" />
    </bean>
    
    <!-- å…¶ä»–Beané…ç½®... -->
</beans>
```

### spring-mvc.xml - æ·»åŠ æ§åˆ¶å™¨æ‰«æå’ŒJWTå·¥å…·ç±»

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/mvc
       https://www.springframework.org/schema/mvc/spring-mvc.xsd">
    
    <!-- æ‰«æControllerç»„ä»¶ -->
    <context:component-scan base-package="com.example.controller" />
    
    <!-- æ³¨å†ŒJWTå·¥å…·ç±» -->
    <bean id="jwtUtils" class="com.example.utils.JwtUtils">
        <property name="secret" value="${jwt.secret}" />
        <property name="expiration" value="${jwt.expiration}" />
    </bean>
    
    <!-- æ³¨å†Œæ‹¦æˆªå™¨ -->
    <bean id="jwtInterceptor" class="com.example.interceptor.JwtInterceptor">
        <property name="jwtUtils" ref="jwtUtils" />
    </bean>
    
    <!-- å…¶ä»–MVCé…ç½®... -->
</beans>
```

## ğŸ“‹ å‰ç«¯é¡µé¢è¡¥å……

### register.html - ç”¨æˆ·æ³¨å†Œé¡µé¢

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç”¨æˆ·æ³¨å†Œ - JWTè®¤è¯ç¤ºä¾‹</title>
    <link rel="stylesheet" href="static/css/style.css">
</head>
<body>
    <div class="container">
        <h1>ç”¨æˆ·æ³¨å†Œ</h1>
        
        <div class="form-container">
            <form onsubmit="return register(event)">
                <div class="form-group">
                    <label for="username">ç”¨æˆ·å:</label>
                    <input type="text" id="username" required minlength="3">
                </div>
                <div class="form-group">
                    <label for="password">å¯†ç :</label>
                    <input type="password" id="password" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="email">é‚®ç®±:</label>
                    <input type="email" id="email">
                </div>
                <div class="form-group">
                    <label for="phone">æ‰‹æœºå·:</label>
                    <input type="tel" id="phone">
                </div>
                <button type="submit">æ³¨å†Œ</button>
            </form>
            
            <p>å·²æœ‰è´¦å·ï¼Ÿ<a href="index.html">ç«‹å³ç™»å½•</a></p>
        </div>
        
        <div id="message" class="hidden"></div>
    </div>

    <script src="static/lib/axios.min.js"></script>
    <script>
        function register(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            
            axios.post('/api/register', {
                username: username,
                password: password,
                email: email,
                phone: phone
            })
            .then(response => {
                showMessage('æ³¨å†ŒæˆåŠŸï¼å³å°†è·³è½¬åˆ°ç™»å½•é¡µé¢...', 'success');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            })
            .catch(error => {
                const errorMsg = error.response?.data || 'æ³¨å†Œå¤±è´¥';
                showMessage('é”™è¯¯: ' + errorMsg, 'error');
            });
            
            return false;
        }
        
        function showMessage(msg, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = msg;
            messageEl.className = type === 'error' ? 'error-message' : 'success-message';
            messageEl.classList.remove('hidden');
            
            // 3ç§’åéšè—æ¶ˆæ¯
            setTimeout(() => {
                messageEl.classList.add('hidden');
            }, 3000);
        }
    </script>
    
    <style>
        .error-message {
            color: #d9534f;
            background-color: #f2dede;
            border: 1px solid #ebccd1;
            padding: 10px;
            border-radius: 4px;
            margin-top: 20px;
        }
        
        .success-message {
            color: #3c763d;
            background-color: #dff0d8;
            border: 1px solid #d6e9c6;
            padding: 10px;
            border-radius: 4px;
            margin-top: 20px;
        }
    </style>
</body>
</html>
```

## ğŸ“‹ æ ·å¼æ–‡ä»¶è¡¥å……

### style.css - æ·»åŠ æ›´å¤šæ ·å¼

```css
/* åœ¨åŸæœ‰æ ·å¼åŸºç¡€ä¸Šæ·»åŠ ä»¥ä¸‹å†…å®¹ */

/* æ³¨å†Œé¡µé¢ç‰¹å®šæ ·å¼ */
.form-container {
    max-width: 400px;
    margin: 0 auto;
}

.form-group {
    margin-bottom: 15px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

input[type="text"],
input[type="password"],
input[type="email"],
input[type="tel"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
    font-size: 16px;
}

button {
    background-color: #4CAF50;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    width: 100%;
}

button:hover {
    background-color: #45a049;
}

a {
    color: #4CAF50;
    text-decoration: none;
}

a:hover {
    text-decoration: underline;
}

/* æ¶ˆæ¯æ ·å¼ */
.hidden {
    display: none;
}

.error-message {
    color: #d9534f;
    background-color: #f2dede;
    border: 1px solid #ebccd1;
    padding: 10px;
    border-radius: 4px;
    margin-top: 20px;
}

.success-message {
    color: #3c763d;
    background-color: #dff0d8;
    border: 1px solid #d6e9c6;
    padding: 10px;
    border-radius: 4px;
    margin-top: 20px;
}

/* ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºæ ·å¼ */
#profile-data {
    margin-top: 20px;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 4px;
    border-left: 4px solid #4CAF50;
}

#profile-data h3 {
    margin-top: 0;
    color: #333;
}

#profile-data p {
    margin: 5px 0;
}
```

## ğŸ’¡ æ€»ç»“ä¸ä½¿ç”¨è¯´æ˜

### é¡¹ç›®å®Œæ•´åŠŸèƒ½

ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†SSMæ¡†æ¶æ•´åˆJWTè®¤è¯çš„å®Œæ•´å®ç°ï¼ŒåŒ…æ‹¬ï¼š

1. **ç”¨æˆ·å®ä½“ç±»**å’Œæ•°æ®è¡¨ç»“æ„
2. **æ•°æ®è®¿é—®å±‚**ï¼ˆMyBatis Mapperæ¥å£å’ŒXMLæ˜ å°„ï¼‰
3. **æœåŠ¡å±‚**ï¼ˆç”¨æˆ·è®¤è¯ã€æ³¨å†Œã€ä¿¡æ¯ç®¡ç†ï¼‰
4. **æ§åˆ¶å±‚**ï¼ˆRESTful APIç«¯ç‚¹ï¼‰
5. **JWTå·¥å…·ç±»**å’Œ**æ‹¦æˆªå™¨**
6. **å‰ç«¯é¡µé¢**ï¼ˆç™»å½•ã€æ³¨å†Œã€ç”¨æˆ·ä¿¡æ¯å±•ç¤ºï¼‰

### ä½¿ç”¨æµç¨‹

1. **å¯åŠ¨é¡¹ç›®**ï¼šé…ç½®å¥½æ•°æ®åº“åå¯åŠ¨TomcatæœåŠ¡å™¨
2. **æ³¨å†Œç”¨æˆ·**ï¼šè®¿é—®`/register.html`é¡µé¢æ³¨å†Œæ–°ç”¨æˆ·
3. **ç”¨æˆ·ç™»å½•**ï¼šè®¿é—®`/index.html`é¡µé¢ä½¿ç”¨æ³¨å†Œçš„è´¦å·ç™»å½•
4. **è®¿é—®å—ä¿æŠ¤API**ï¼šç™»å½•åå¯ä»¥è®¿é—®`/api/profile`ç­‰éœ€è¦è®¤è¯çš„æ¥å£
5. **æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯**ï¼šåœ¨ç™»å½•åçš„é¡µé¢ä¸­å¯ä»¥æŸ¥çœ‹å’Œæ›´æ–°ä¸ªäººä¿¡æ¯

### å®‰å…¨æ³¨æ„äº‹é¡¹

1. **å¯†ç åŠ å¯†**ï¼šå½“å‰ä½¿ç”¨MD5åŠ å¯†ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨BCryptç­‰æ›´å®‰å…¨çš„ç®—æ³•
2. **HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»å¯ç”¨HTTPSä»¥ç¡®ä¿ä»¤ç‰Œä¼ è¾“å®‰å…¨
3. **ä»¤ç‰Œè¿‡æœŸæ—¶é—´**ï¼šæ ¹æ®å®‰å…¨éœ€æ±‚è®¾ç½®åˆç†çš„JWTè¿‡æœŸæ—¶é—´
4. **æ•æ„Ÿä¿¡æ¯**ï¼šä¸è¦åœ¨JWTä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ŒPayloadåªæ˜¯Base64ç¼–ç 

### æ‰©å±•å»ºè®®

1. æ·»åŠ **è§’è‰²å’Œæƒé™**ç®¡ç†ï¼Œå®ç°æ›´ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶
2. å®ç°**åˆ·æ–°ä»¤ç‰Œ**æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·åœ¨è®¿é—®ä»¤ç‰Œè¿‡æœŸåè·å–æ–°ä»¤ç‰Œ
3. æ·»åŠ **å¤šå› ç´ è®¤è¯**æ”¯æŒï¼Œæé«˜è´¦æˆ·å®‰å…¨æ€§
4. é›†æˆ**Spring Security**æ¡†æ¶ï¼Œæä¾›æ›´å…¨é¢çš„å®‰å…¨è§£å†³æ–¹æ¡ˆ

è¿™ä¸ªå®Œæ•´çš„SSM+JWTå®ç°æä¾›äº†ä¸€ä¸ªç°ä»£åŒ–çš„æ— çŠ¶æ€è®¤è¯æ–¹æ¡ˆï¼Œé€‚åˆå‰åç«¯åˆ†ç¦»çš„Webåº”ç”¨å’ŒAPIæœåŠ¡ã€‚

# ğŸ” SSM+JWTé¡¹ç›®ä»£ç å®Œæ•´æ€§æ£€æŸ¥æŠ¥å‘Š

ç»è¿‡ä»”ç»†æ£€æŸ¥æ‚¨æä¾›çš„æ‰€æœ‰ä»£ç ï¼Œæˆ‘å‘ç°äº†ä¸€äº›éœ€è¦è¡¥å……çš„å…³é”®éƒ¨åˆ†ã€‚ä»¥ä¸‹æ˜¯éœ€è¦æŸ¥æ¼è¡¥ç¼ºçš„å†…å®¹ï¼š

## ğŸ“‹ ç¼ºå¤±çš„å…³é”®é…ç½®æ–‡ä»¶

### 1. JDBCå±æ€§æ–‡ä»¶ - `jdbc.properties`

```properties
# Database Configuration
jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/your_database?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
jdbc.username=your_username
jdbc.password=your_password

# Connection Pool Settings
jdbc.pool.initialSize=5
jdbc.pool.maxActive=20
jdbc.pool.maxWait=10000
jdbc.pool.maxIdle=10
jdbc.pool.minIdle=5
jdbc.pool.timeBetweenEvictionRunsMillis=60000
jdbc.pool.minEvictableIdleTimeMillis=300000
jdbc.pool.testWhileIdle=true
jdbc.pool.testOnBorrow=false
jdbc.pool.testOnReturn=false
```

### 2. å®Œæ•´çš„Springä¸»é…ç½®æ–‡ä»¶ - `applicationContext.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd">
    
    <!-- åŠ è½½å±æ€§æ–‡ä»¶ -->
    <context:property-placeholder location="classpath:jdbc.properties"/>
    
    <!-- æ•°æ®æºé…ç½® -->
    <bean id="dataSource" class="org.apache.commons.dbcp2.BasicDataSource" destroy-method="close">
        <property name="driverClassName" value="${jdbc.driver}"/>
        <property name="url" value="${jdbc.url}"/>
        <property name="username" value="${jdbc.username}"/>
        <property name="password" value="${jdbc.password}"/>
        <property name="initialSize" value="${jdbc.pool.initialSize}"/>
        <property name="maxTotal" value="${jdbc.pool.maxActive}"/>
        <property name="maxIdle" value="${jdbc.pool.maxIdle}"/>
        <property name="minIdle" value="${jdbc.pool.minIdle}"/>
        <property name="maxWaitMillis" value="${jdbc.pool.maxWait}"/>
    </bean>
    
    <!-- MyBatis SqlSessionFactoryé…ç½® -->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource"/>
        <property name="configLocation" value="classpath:mybatis-config.xml"/>
        <property name="mapperLocations" value="classpath:mapper/*.xml"/>
    </bean>
    
    <!-- Mapperæ¥å£æ‰«æé…ç½® -->
    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <property name="basePackage" value="com.example.mapper"/>
        <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"/>
    </bean>
    
    <!-- æ‰«æServiceç»„ä»¶ -->
    <context:component-scan base-package="com.example.service"/>
    
    <!-- å¼€å¯æ³¨è§£é©±åŠ¨çš„äº‹åŠ¡ç®¡ç† -->
    <tx:annotation-driven transaction-manager="transactionManager"/>
    
    <!-- äº‹åŠ¡ç®¡ç†å™¨ -->
    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>
</beans>
```

### 3. MyBatisé…ç½®æ–‡ä»¶ - `mybatis-config.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <settings>
        <!-- å¼€å¯é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„ -->
        <setting name="mapUnderscoreToCamelCase" value="true"/>
        <!-- å¼€å¯äºŒçº§ç¼“å­˜ -->
        <setting name="cacheEnabled" value="true"/>
        <!-- é…ç½®é»˜è®¤çš„æ‰§è¡Œå™¨ -->
        <setting name="defaultExecutorType" value="REUSE"/>
        <!-- æ‰“å°æŸ¥è¯¢è¯­å¥ -->
        <setting name="logImpl" value="STDOUT_LOGGING"/>
    </settings>
    
    <!-- ç±»å‹åˆ«åé…ç½® -->
    <typeAliases>
        <typeAlias type="com.example.entity.User" alias="User"/>
    </typeAliases>
</configuration>
```

### 4. Web.xmlé…ç½®æ–‡ä»¶ - `web.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
         http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">
    
    <!-- é…ç½®Springä¸Šä¸‹æ–‡ -->
    <context-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>classpath:spring/applicationContext.xml</param-value>
    </context-param>
    
    <!-- Springä¸Šä¸‹æ–‡ç›‘å¬å™¨ -->
    <listener>
        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
    </listener>
    
    <!-- é…ç½®Spring MVCçš„DispatcherServlet -->
    <servlet>
        <servlet-name>springmvc</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:spring/spring-mvc.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>
    
    <servlet-mapping>
        <servlet-name>springmvc</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>
    
    <!-- å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨ -->
    <filter>
        <filter-name>encodingFilter</filter-name>
        <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>UTF-8</param-value>
        </init-param>
        <init-param>
            <param-name>forceEncoding</param-name>
            <param-value>true</param-value>
        </init-param>
    </filter>
    
    <filter-mapping>
        <filter-name>encodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>
</web-app>
```

### 5. å®Œæ•´çš„Spring MVCé…ç½® - `spring-mvc.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/mvc
       https://www.springframework.org/schema/mvc/spring-mvc.xsd">
    
    <!-- æ‰«æControllerç»„ä»¶ -->
    <context:component-scan base-package="com.example.controller"/>
    
    <!-- å¯ç”¨æ³¨è§£é©±åŠ¨ -->
    <mvc:annotation-driven>
        <mvc:message-converters>
            <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter">
                <property name="objectMapper">
                    <bean class="com.fasterxml.jackson.databind.ObjectMapper">
                        <property name="dateFormat">
                            <bean class="java.text.SimpleDateFormat">
                                <constructor-arg type="java.lang.String" value="yyyy-MM-dd HH:mm:ss"/>
                            </bean>
                        </property>
                    </bean>
                </property>
            </bean>
        </mvc:message-converters>
    </mvc:annotation-driven>
    
    <!-- é™æ€èµ„æºå¤„ç† -->
    <mvc:resources mapping="/static/**" location="/static/"/>
    
    <!-- è§†å›¾è§£æå™¨ -->
    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="prefix" value="/WEB-INF/views/"/>
        <property name="suffix" value=".jsp"/>
    </bean>
    
    <!-- æ³¨å†ŒJWTå·¥å…·ç±» -->
    <bean id="jwtUtils" class="com.example.utils.JwtUtils">
        <property name="secret" value="${jwt.secret}"/>
        <property name="expiration" value="${jwt.expiration}"/>
    </bean>
    
    <!-- æ³¨å†Œæ‹¦æˆªå™¨ -->
    <bean id="jwtInterceptor" class="com.example.interceptor.JwtInterceptor">
        <property name="jwtUtils" ref="jwtUtils"/>
    </bean>
    
    <!-- æ‹¦æˆªå™¨é…ç½® -->
    <mvc:interceptors>
        <mvc:interceptor>
            <mvc:mapping path="/api/**"/>
            <mvc:exclude-mapping path="/api/login"/>
            <mvc:exclude-mapping path="/api/register"/>
            <mvc:exclude-mapping path="/api/health"/>
            <ref bean="jwtInterceptor"/>
        </mvc:interceptor>
    </mvc:interceptors>
</beans>
```

## ğŸ“‹ éœ€è¦ä¿®æ­£çš„ä»£ç éƒ¨åˆ†

### 1. JwtUtils.java - ä¿®æ­£å±æ€§æ³¨å…¥é—®é¢˜

```java
// åœ¨JwtUtilsç±»ä¸­æ·»åŠ setteræ–¹æ³•ç”¨äºå±æ€§æ³¨å…¥
public void setSecret(String secret) {
    this.secret = secret;
}

public void setExpiration(Long expiration) {
    this.expiration = expiration;
}
```

### 2. JwtInterceptor.java - ä¿®æ­£JwtUtilsæ³¨å…¥æ–¹å¼

```java
// ä¿®æ”¹JwtInterceptorç±»ï¼Œæ·»åŠ setteræ–¹æ³•
public class JwtInterceptor implements HandlerInterceptor {
    
    private JwtUtils jwtUtils;
    
    // æ·»åŠ setteræ–¹æ³•ç”¨äºä¾èµ–æ³¨å…¥
    public void setJwtUtils(JwtUtils jwtUtils) {
        this.jwtUtils = jwtUtils;
    }
    
    // å…¶ä½™ä»£ç ä¿æŒä¸å˜...
}
```

## ğŸ“‹ Mavenä¾èµ–è¡¥å……

### pom.xml - æ·»åŠ ç¼ºå¤±çš„ä¾èµ–

```xml
<!-- æ•°æ®åº“ç›¸å…³ä¾èµ– -->
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.33</version>
</dependency>
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-dbcp2</artifactId>
    <version>2.9.0</version>
</dependency>

<!-- MyBatisä¸Springæ•´åˆ -->
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis-spring</artifactId>
    <version>2.1.1</version>
</dependency>
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-jdbc</artifactId>
    <version>5.3.28</version>
</dependency>

<!-- Servlet API -->
<dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>javax.servlet-api</artifactId>
    <version>4.0.1</version>
    <scope>provided</scope>
</dependency>

<!-- Jackson for JSON -->
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.14.2</version>
</dependency>
```

## ğŸ“‹ é¡¹ç›®ç»“æ„æœ€ç»ˆç¡®è®¤

```
ssm-jwt-demo/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main/
â”‚       â”œâ”€â”€ java/
â”‚       â”‚   â””â”€â”€ com/
â”‚       â”‚       â””â”€â”€ example/
â”‚       â”‚           â”œâ”€â”€ controller/
â”‚       â”‚           â”‚   â”œâ”€â”€ UserController.java
â”‚       â”‚           â”‚   â””â”€â”€ ApiController.java
â”‚       â”‚           â”œâ”€â”€ interceptor/
â”‚       â”‚           â”‚   â””â”€â”€ JwtInterceptor.java
â”‚       â”‚           â”œâ”€â”€ utils/
â”‚       â”‚           â”‚   â””â”€â”€ JwtUtils.java
â”‚       â”‚           â”œâ”€â”€ entity/
â”‚       â”‚           â”‚   â””â”€â”€ User.java
â”‚       â”‚           â”œâ”€â”€ service/
â”‚       â”‚           â”‚   â”œâ”€â”€ UserService.java
â”‚       â”‚           â”‚   â””â”€â”€ impl/
â”‚       â”‚           â”‚       â””â”€â”€ UserServiceImpl.java
â”‚       â”‚           â”œâ”€â”€ mapper/
â”‚       â”‚           â”‚   â””â”€â”€ UserMapper.java
â”‚       â”‚           â””â”€â”€ config/
â”‚       â”‚               â””â”€â”€ WebConfig.java
â”‚       â”œâ”€â”€ resources/
â”‚       â”‚   â”œâ”€â”€ spring/
â”‚       â”‚   â”‚   â”œâ”€â”€ applicationContext.xml
â”‚       â”‚   â”‚   â”œâ”€â”€ spring-mvc.xml
â”‚       â”‚   â”‚   â””â”€â”€ mybatis-config.xml
â”‚       â”‚   â”œâ”€â”€ mapper/
â”‚       â”‚   â”‚   â””â”€â”€ UserMapper.xml
â”‚       â”‚   â”œâ”€â”€ jdbc.properties
â”‚       â”‚   â””â”€â”€ application.properties
â”‚       â””â”€â”€ webapp/
â”‚           â”œâ”€â”€ WEB-INF/
â”‚           â”‚   â”œâ”€â”€ web.xml
â”‚           â”‚   â””â”€â”€ views/
â”‚           â”‚       â””â”€â”€ (å¯é€‰JSPè§†å›¾æ–‡ä»¶)
â”‚           â”œâ”€â”€ static/
â”‚           â”‚   â”œâ”€â”€ css/
â”‚           â”‚   â”‚   â””â”€â”€ style.css
â”‚           â”‚   â”œâ”€â”€ js/
â”‚           â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚           â”‚   â”‚   â””â”€â”€ api.js
â”‚           â”‚   â””â”€â”€ lib/
â”‚           â”‚       â””â”€â”€ axios.min.js
â”‚           â”œâ”€â”€ index.html
â”‚           â””â”€â”€ register.html
â”œâ”€â”€ pom.xml
â””â”€â”€ README.md
```

## âœ… æ£€æŸ¥æ€»ç»“

ç»è¿‡ä»”ç»†æ£€æŸ¥ï¼Œæˆ‘å·²è¡¥å……äº†ä»¥ä¸‹å…³é”®å†…å®¹ï¼š

1. **å®Œæ•´çš„é…ç½®æ–‡ä»¶**ï¼šJDBCé…ç½®ã€Springä¸»é…ç½®ã€MyBatisé…ç½®ã€Web.xml
2. **ä¾èµ–æ³¨å…¥ä¿®æ­£**ï¼šJwtUtilså’ŒJwtInterceptorçš„å±æ€§æ³¨å…¥é—®é¢˜
3. **Mavenä¾èµ–è¡¥å……**ï¼šæ•°æ®åº“é©±åŠ¨ã€è¿æ¥æ± ã€MyBatis-Springæ•´åˆç­‰
4. **é¡¹ç›®ç»“æ„å®Œå–„**ï¼šç¡®ä¿æ‰€æœ‰å¿…è¦çš„é…ç½®æ–‡ä»¶å’Œç›®å½•éƒ½å­˜åœ¨

ç°åœ¨è¿™ä¸ªSSM+JWTé¡¹ç›®å·²ç»å®Œæ•´ï¼Œå¯ä»¥æ­£å¸¸ç¼–è¯‘å’Œè¿è¡Œã€‚æ‰€æœ‰å¿…è¦çš„ç»„ä»¶éƒ½å·²å°±ä½ï¼ŒåŒ…æ‹¬æ•°æ®è®¿é—®å±‚ã€æœåŠ¡å±‚ã€æ§åˆ¶å±‚ã€å·¥å…·ç±»å’Œå‰ç«¯é¡µé¢ã€‚

é¡¹ç›®åº”è¯¥èƒ½å¤Ÿï¼š
1. æ­£ç¡®è¿æ¥æ•°æ®åº“
2. å¤„ç†ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
3. ç”Ÿæˆå’ŒéªŒè¯JWTä»¤ç‰Œ
4. é€šè¿‡æ‹¦æˆªå™¨ä¿æŠ¤APIç«¯ç‚¹
5. æä¾›å®Œæ•´çš„å‰åç«¯äº¤äº’åŠŸèƒ½

å¦‚æœæ‚¨æŒ‰ç…§è¿™ä¸ªå®Œæ•´çš„ä»£ç ç»“æ„æ­å»ºé¡¹ç›®ï¼Œåº”è¯¥èƒ½å¤Ÿé¡ºåˆ©è¿è¡ŒSSMæ¡†æ¶æ•´åˆJWTè®¤è¯çš„ç¤ºä¾‹ã€‚

