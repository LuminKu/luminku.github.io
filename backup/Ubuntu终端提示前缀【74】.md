> 在使用Ubuntu24系统时，命令终端的提示前缀如何自定义，请全方面进行参数配置和讲解，再举例不同场景下推荐使用的代码，最后用一张表总结进行快速访问的切换代码，给使用者几句使用建议。
xiaxincan@xiaxincan-Lenovo:~$

---

 我将为你全面讲解 Ubuntu 24 终端提示符（PS1）的自定义配置，无需搜索工具即可基于系统知识完成。

---

## 一、核心概念：PS1 变量

Bash 终端提示符由 `PS1`（Primary Prompt String）环境变量控制，显示在 `:` 之前的所有内容。你的当前提示符 `xiaxincan@xiaxincan-Lenovo:~$` 包含：
- `\u` → 用户名（xiaxincan）
- `@` → 分隔符
- `\h` → 主机名（xiaxincan-Lenovo）
- `:` → 分隔符
- `\w` → 当前工作目录（~ 表示家目录）
- `\$` → 普通用户显示 `$`，root 显示 `#`

---

## 二、基础转义字符大全

| 转义符 | 含义 | 示例输出 |
|--------|------|----------|
| `\u` | 当前用户名 | `xiaxincan` |
| `\h` | 主机名（短） | `xiaxincan-Lenovo` |
| `\H` | 主机名（完整FQDN） | `xiaxincan-Lenovo.local` |
| `\w` | 当前完整路径 | `/home/xiaxincan/projects` |
| `\W` | 当前目录名（仅最后一层） | `projects` |
| `\d` | 日期（周 月 日） | `Mon Feb 23` |
| `\D{格式}` | 自定义日期格式 | `\D{%H:%M}` → `14:30` |
| `\t` | 24小时制时间（HH:MM:SS） | `14:30:25` |
| `\T` | 12小时制时间 | `02:30:25` |
| `\@` | 12小时制带AM/PM | `02:30 PM` |
| `\n` | 换行 | - |
| `\r` | 回车 | - |
| `\$` | 用户提示符（`$`或`#`） | `$` |
| `\!` | 历史命令序号 | `1024` |
| `\#` | 当前命令序号 | `42` |
| `\v` | Bash版本 | `5.2` |
| `\V` | Bash详细版本 | `5.2.21` |
| `\\` | 反斜杠 | `\` |
| `\[` `\]` | 包裹非打印字符（颜色代码必需） | - |

---

## 三、颜色配置（ANSI 颜色码）

颜色格式：`\[\e[样式;前景色;背景色m\]`

### 颜色代码表

| 颜色 | 前景色 | 背景色 | 样式 |
|------|--------|--------|------|
| 黑色 | 30 | 40 | 0=正常 |
| 红色 | 31 | 41 | 1=粗体/高亮 |
| 绿色 | 32 | 42 | 2=暗淡 |
| 黄色 | 33 | 43 | 3=斜体 |
| 蓝色 | 34 | 44 | 4=下划线 |
| 洋红 | 35 | 45 | 5=闪烁 |
| 青色 | 36 | 46 | 7=反显 |
| 白色 | 37 | 47 | 8=隐藏 |

**重置颜色**：`\[\e[0m\]`

---

## 四、不同场景配置实例

### 1. 极简主义（适合截图/录屏）
```bash
# 仅显示当前目录和 $
PS1='\W \$ '
# 输出：projects $
```

### 2. 开发者专业版（含Git分支、时间戳）
```bash
# 需要安装 git（通常已预装）
parse_git_branch() {
    git branch 2>/dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ (\1)/'
}
PS1='\[\e[1;36m\]\t\[\e[0m\] \[\e[1;32m\]\u@\h\[\e[0m\]:\[\e[1;34m\]\w\[\e[33m\]$(parse_git_branch)\[\e[0m\]\$ '
```
**效果**：`14:30:25 xiaxincan@xiaxincan-Lenovo:~/projects (main)$`

### 3. 多行信息版（长路径不拥挤）
```bash
PS1='\[\e[1;35m\]┌─[\[\e[1;36m\]\u\[\e[0m\]@\[\e[1;36m\]\h\[\e[1;35m\]]-[\[\e[1;33m\]\D{%Y-%m-%d %H:%M}\[\e[1;35m\]]-[\[\e[1;32m\]\w\[\e[1;35m\]]\n\[\e[1;35m\]└─\[\e[0m\]\$ '
```
**效果**：
```
┌─[xiaxincan@xiaxincan-Lenovo]-[2024-02-23 14:30]-[/home/xiaxincan/projects]
└─$ 
```

### 4. 生产服务器安全版（高对比度警告）
```bash
# 红色背景提醒这是生产环境
PS1='\[\e[1;37;41m\][PROD]\[\e[0m\] \[\e[1;31m\]\u\[\e[0m\]@\[\e[1;33m\]\H\[\e[0m\]:\[\e[1;34m\]\w\[\e[0m\]\$ '
```
**效果**：白字红底 `[PROD]` 标签，醒目提示

### 5. 动态路径缩短（长路径显示...）
```bash
# 路径超过3层时显示 ...
PROMPT_DIRTRIM=3
PS1='\[\e[1;32m\]\u\[\e[0m\]:\[\e[1;34m\]\w\[\e[0m\]\$ '
# /home/xiaxincan/a/b/c/d/e 显示为 ~/a/b/.../e
```

### 6. 退出状态显示（上条命令失败标红）
```bash
# 上条命令非0退出时显示红色错误码
PS1='\[\e[1;32m\]\u@\h\[\e[0m\]:\[\e[1;34m\]\w\[\e[0m\] $(code=$?; [ $code -ne 0 ] && echo "\[\e[1;31m\][✗ $code]\[\e[0m\] ")\$ '
```

---

## 五、持久化配置方法

### 方法1：仅当前用户生效（推荐）
编辑 `~/.bashrc`：
```bash
nano ~/.bashrc
# 在文件末尾添加你的 PS1 定义
export PS1='你的自定义代码'
# 保存后生效
source ~/.bashrc
```

### 方法2：全局生效（所有用户）
```bash
sudo nano /etc/bash.bashrc
# 添加 PS1 定义
```

### 方法3：区分 root/普通用户
在 `~/.bashrc` 中使用条件判断：
```bash
if [ "$EUID" -eq 0 ]; then
    # root 用户：红色背景警告
    PS1='\[\e[1;37;41m\][ROOT]\[\e[0m\] \[\e[1;31m\]\h\[\e[0m\]:\[\e[1;33m\]\w\[\e[0m\]# '
else
    # 普通用户：绿色主题
    PS1='\[\e[1;32m\]\u@\h\[\e[0m\]:\[\e[1;34m\]\w\[\e[0m\]\$ '
fi
```

---

## 六、快速切换代码表

| 场景 | 一键切换代码 | 特点 |
|------|-------------|------|
| **恢复默认** | `PS1='\u@\h:\w\$ '` | Ubuntu 原始风格 |
| **极简模式** | `PS1='\W \$ '` | 最简洁，适合截图 |
| **开发模式** | `PS1='\[\e[1;36m\]\t\[\e[0m\] \[\e[1;32m\]\u\[\e[0m\]:\[\e[1;34m\]\W\[\e[0m\]\$ '` | 含时间、彩色目录 |
| **多行模式** | `PS1='\[\e[1;35m\]┌─[\[\e[36m\]\u@\h\[\e[35m\]]-[\[\e[33m\]\w\[\e[35m\]]\n\[\e[35m\]└─\[\e[0m\]\$ '` | 信息不拥挤 |
| **高亮路径** | `PS1='\u@\h:\[\e[1;33m\]\w\[\e[0m\]\$ '` | 仅目录黄色高亮 |
| **隐藏主机** | `PS1='\[\e[1;32m\]\u\[\e[0m\]:\[\e[1;34m\]\w\[\e[0m\]\$ '` | 隐私保护，不显示主机名 |
| **全路径模式** | `PS1='[\t] \u@\H:\w\$ '` | 显示完整FQDN主机名 |
| **命令序号** | `PS1='[\!] \u@\h:\W\$ '` | 显示历史命令编号 |

---

## 七、进阶技巧

### 1. 条件颜色（根据用户/主机变色）
```bash
# 不同主机不同颜色
case $(hostname) in
    "server-prod") COLOR="1;31" ;;  # 生产环境红色
    "server-test") COLOR="1;33" ;;  # 测试环境黄色
    *) COLOR="1;32" ;;               # 开发环境绿色
esac
PS1="\[\e[${COLOR}m\]\u@\h\[\e[0m\]:\w\$ "
```

### 2. 右侧提示符（RPROMPT 效果）
Bash 不支持原生右对齐，但可通过 trick 实现：
```bash
# 在提示符前打印右侧信息（需计算终端宽度）
__rprompt() {
    local text=" $(date +%H:%M) "
    local width=$(tput cols)
    local len=${#text}
    printf "%*s" $((width - len)) ""
    echo -e "\e[1;30m$text\e[0m"
}
PS1='$(__rprompt)\r\u@\h:\w\$ '
```

### 3. 动态标题（终端窗口标题）
```bash
# 同时设置终端标题
PS1='\[\e]0;\u@\h: \w\a\]\u@\h:\w\$ '
# \e]0;...\a 是设置窗口标题的转义序列
```

---

## 八、使用建议

1. **颜色包裹必用 `\[` `\]`**：所有颜色代码必须用 `\[` `\]` 包裹，否则 Bash 计算行宽错误，导致长命令换行异常。

2. **测试先于写入**：在终端直接输入 `PS1='...'` 实时预览，满意后再写入 `~/.bashrc`，避免配置错误导致提示符混乱。

3. **Git 分支检测性能**：在大型仓库中，每次显示提示符都执行 `git branch` 可能有延迟，可考虑使用 ` PROMPT_COMMAND` 异步更新或使用 `starship` 等现代提示符工具。

4. **特殊字符转义**：如果提示符包含 `$`、`` ` ``、`\` 等，需用 `\` 转义或改用单引号定义 PS1。

5. **跨会话一致性**：将配置放入 `~/.bashrc` 而非 `~/.profile`，确保非登录 Shell（如新开终端标签页）也能生效。

6. **备份原始配置**：修改前注释掉原 PS1 行，添加 `# Original: ...` 备注，方便回滚。

7. **考虑使用 Starship**：如果需求复杂（多语言版本管理、异步 Git 状态、右侧提示符），推荐安装 [Starship](https://starship.rs/) 替代手动配置，它跨 Shell 且性能优异：
   ```bash
   curl -sS https://starship.rs/install.sh | sh
   echo 'eval "$(starship init bash)"' >> ~/.bashrc
   ```

---

通过以上配置，你可以打造既美观又实用的终端提示符，显著提升命令行工作效率！